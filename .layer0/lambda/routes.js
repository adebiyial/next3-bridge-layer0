var Lu=Object.create,Ve=Object.defineProperty,Nu=Object.defineProperties,Iu=Object.getOwnPropertyDescriptor,$u=Object.getOwnPropertyDescriptors,ku=Object.getOwnPropertyNames,Wt=Object.getOwnPropertySymbols,Uu=Object.getPrototypeOf,Br=Object.prototype.hasOwnProperty,wn=Object.prototype.propertyIsEnumerable;var Sn=(e,t,r)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))Br.call(t,r)&&Sn(e,r,t[r]);if(Wt)for(var r of Wt(t))wn.call(t,r)&&Sn(e,r,t[r]);return e},w=(e,t)=>Nu(e,$u(t)),xn=e=>Ve(e,"__esModule",{value:!0});var Hn=(e,t)=>{var r={};for(var s in e)Br.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&Wt)for(var s of Wt(e))t.indexOf(s)<0&&wn.call(e,s)&&(r[s]=e[s]);return r};var f=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Bu=(e,t)=>{for(var r in t)Ve(e,r,{get:t[r],enumerable:!0})},Fu=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ku(t))!Br.call(e,s)&&s!=="default"&&Ve(e,s,{get:()=>t[s],enumerable:!(r=Iu(t,s))||r.enumerable});return e},Wu=e=>Fu(xn(Ve(e!=null?Lu(Uu(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var S=f(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.LAYER0_CONFIG_FILE="layer0.config.js";C.LAYER0_ASSET_ALIASES_FILE="asset-aliases.json";C.LAYER0_ENV_VARIABLES={config:"LAYER0_CONFIG",deploymentType:"LAYER0_DEPLOYMENT_TYPE",versionOverride:"LAYER0_VERSION_OVERRIDE"};C.LAYER0_DEPLOYMENT_TYPE_AWS="AWS";C.LAYER0_HEADERS_PREFIX="x-0-";C.LAYER0_MAX_USER_HEADERS_ALLOWED=70;C.LAYER0_TOO_MANY_HEADERS_STATUS_CODE=542;C.LAYER0_UNCACHED_PREFETCH_STATUS=412;C.ACTIONS={setHeader:"set-header",updateHeader:"update-header",removeHeader:"remove-header",syntheticRes:"synthetic-response",updatePath:"update-path",proxy:"proxy",addCookie:"add-cookie",updateCookie:"update-cookie",removeCookie:"remove-cookie"};C.BACKENDS={js:"__js__",static:"__static__",permanentStatic:"__permanent_static__",imageOptimizer:"__image_optimizer__"};C.JS_BACKEND_HOSTNAME="127.0.0.1";C.HTTP_METHODS={head:"head",get:"get",post:"post",delete:"delete",put:"put",patch:"patch",options:"options"};C.HTTP_HEADERS={authorization:"authorization",acceptEncoding:"accept-encoding",cacheControl:"cache-control",contentEncoding:"content-encoding",contentLength:"content-length",contentType:"content-type",cookie:"cookie",host:"host",location:"location",serverTiming:"server-timing",setCookie:"set-cookie",userAgent:"user-agent",vary:"vary",xForwardedFor:"x-forwarded-for",xRequestId:"x-request-id",xSwCacheControl:"x-sw-cache-control",x0Browser:"x-0-browser",x0CacheControl:"x-0-cache-control",x0CachingStatus:"x-0-caching-status",x0ClientIp:"x-0-client-ip",x0Components:"x-0-components",x0Destination:"x-0-destination",x0Device:"x-0-device",x0DeviceIsBot:"x-0-device-is-bot",x0GeoCity:"x-0-geo-city",x0GeoCountryCode:"x-0-geo-country-code",x0GeoLatitude:"x-0-geo-latitude",x0GeoLongitude:"x-0-geo-longitude",x0GeoPostalCode:"x-0-geo-postal-code",x0MatchedRoutes:"x-0-matched-routes",x0Protocol:"x-0-protocol",x0Route:"x-0-route",x0Status:"x-0-status",x0SurrogateKey:"x-0-surrogate-key",x0T:"x-0-t",x0UserT:"x-0-user-t",x0Vendor:"x-0-vendor",x0Version:"x-0-version"};C.CACHING_STATUS={ok:"ok",private:"private",method:"method",bodyTooBig:"body-too-big",code:"code",setCookie:"set-cookie",noMaxAge:"no-max-age"};C.CACHEABLE_METHODS=new Set(["get","head"]);C.THROTTLED_QUERY_PARAM="layer0_prefetch";C.PREFETCH_QUERY_PARAM=C.THROTTLED_QUERY_PARAM;C.DEVTOOLS_PREFETCH_QUERY_PARAM="layer0_dt_pf";C.HEAD_QUERY_PARAM="layer0_head";C.POST_BODY_QUERY_PARAM="pref_layer0_body";C.METHOD_QUERY_PARAM="pref_layer0_method";C.ROUTES_FALLBACK="fallback";C.ROUTES_CATCH_GROUP="catch";C.LAYER0_IMAGE_OPTIMIZER_PATH="/__layer0_image_optimizer"});var Ye=f(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});var Pn=S();function On(){return process.env[Pn.LAYER0_ENV_VARIABLES.deploymentType]===Pn.LAYER0_DEPLOYMENT_TYPE_AWS}Se.isCloud=On;function Gu(){return process.env.LAYER0_LOCAL==="true"}Se.isLocal=Gu;function Dn(){return process.env.NODE_ENV==="production"}Se.isProductionBuild=Dn;function Vu(){return!On()&&!Dn()}Se.isLayer0RunDev=Vu});var Fr=f((o_,qn)=>{"use strict";qn.exports=e=>{let t=/^\\\\\?\\/.test(e),r=/[^\u0000-\u0080]+/.test(e);return t||r?e:e.replace(/\\/g,"/")}});var ue=f((exports,module)=>{"use strict";var __importDefault=exports&&exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var slash_1=__importDefault(Fr());function nonWebpackRequire(modulePath,{ignoreErrors=!1}={}){try{return eval("require")(slash_1.default(modulePath))}catch(e){if(ignoreErrors)return;throw e}}exports.default=nonWebpackRequire});var In=f(ce=>{"use strict";var Yu=ce&&ce.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ce,"__esModule",{value:!0});var Ku=Ye(),Mn=Yu(ue()),jn="layer0",Wr;function zu(e){return Ku.isLocal()?Qu().runAndReturn(e):(global.__layer0_timings__=new Nn,e())}ce.withContext=zu;function Ln(){return global.__layer0_timings__||Ju()}function Qu(){let e=Mn.default("cls-hooked");return Wr||(Wr=e.createNamespace(jn)),Wr}function Ju(){return Mn.default("cls-hooked").getNamespace(jn)}function Xu(e,t){try{let r=Ln(),s=r.get(e);return s==null&&(s=t,r.set(e,t)),s}catch(r){return t}}ce.get=Xu;function Zu(e,t){try{Ln().set(e,t)}catch(r){throw new Error("set must be called within withContext")}}ce.set=Zu;var Nn=class{constructor(){this.values={}}get(t){return this.values[t]}set(t,r){this.values[t]=r}}});var zr=f(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});var Gt=S(),Gr=In();N.NOT_ENDED_VALUE="na";var Vr=class{constructor(t,r=!0){this.duration=0,this.ended=!1,this.name=t,(r?Yr():Kr()).push(this)}start(){return this.startTime=new Date,this.ended=!1,this}set(t){return this.discreteValue=t,this}end(){return this.startTime?(this.ended=!0,this.duration+=new Date().getTime()-this.startTime.getTime(),this):(console.warn(`Timing ${this.name} not started.`),this)}pause(){return this.end()}resume(){return this.start()}get value(){return this.discreteValue!=null?this.discreteValue:this.ended?this.duration:N.NOT_ENDED_VALUE}};N.InternalTiming=Vr;function ec(e){return(...t)=>Gr.withContext(()=>e(...t))}N.withTimings=ec;function tc(e){var t;return(t=Yr().find(r=>r.name===e))===null||t===void 0?void 0:t.value}N.getInternalTiming=tc;function Yr(){return Gr.get("internalTimings",[])}function Kr(){return Gr.get("userTimings",[])}function rc(e){let t=Kr(),r=Yr();t.length&&(e.setHeader(Gt.HTTP_HEADERS.x0UserT,$n(t)),e.setHeader(Gt.HTTP_HEADERS.serverTiming,sc(e))),r.length&&e.setHeader(Gt.HTTP_HEADERS.x0T,$n(r))}N.addTimings=rc;function $n(e){return e.map(t=>`${t.name}=${t.value}`).join(",")}function sc(e){let t=e.getHeader(Gt.HTTP_HEADERS.serverTiming),r=Kr().map(s=>`${s.name};dur=${s.value}`);return Array.isArray(t)?r.push(...t):t&&r.push(t),r.join(", ")}var kn=class extends Vr{constructor(t){super(t,!1)}};N.default=kn;var nc;(function(e){e.edgeCache="oc",e.transformRequest="wa",e.transformResponse="wz",e.routeMatching="wr",e.proxying="wp"})(nc=N.InternalNames||(N.InternalNames={}));var ic;(function(e){e.hit="hit",e.pass="pass",e.cached="cached"})(ic=N.CacheValue||(N.CacheValue={}))});var Jr=f(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.default=uc;var oc=ac(require("crypto"));function ac(e){return e&&e.__esModule?e:{default:e}}var Vt=new Uint8Array(256),Yt=Vt.length;function uc(){return Yt>Vt.length-16&&(oc.default.randomFillSync(Vt),Yt=0),Vt.slice(Yt,Yt+=16)}});var Un=f(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.default=void 0;var cc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;Kt.default=cc});var Ke=f(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.default=void 0;var lc=hc(Un());function hc(e){return e&&e.__esModule?e:{default:e}}function dc(e){return typeof e=="string"&&lc.default.test(e)}var fc=dc;zt.default=fc});var ze=f(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.default=void 0;var pc=gc(Ke());function gc(e){return e&&e.__esModule?e:{default:e}}var O=[];for(let e=0;e<256;++e)O.push((e+256).toString(16).substr(1));function _c(e,t=0){let r=(O[e[t+0]]+O[e[t+1]]+O[e[t+2]]+O[e[t+3]]+"-"+O[e[t+4]]+O[e[t+5]]+"-"+O[e[t+6]]+O[e[t+7]]+"-"+O[e[t+8]]+O[e[t+9]]+"-"+O[e[t+10]]+O[e[t+11]]+O[e[t+12]]+O[e[t+13]]+O[e[t+14]]+O[e[t+15]]).toLowerCase();if(!(0,pc.default)(r))throw TypeError("Stringified UUID is invalid");return r}var mc=_c;Qt.default=mc});var Wn=f(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.default=void 0;var vc=Bn(Jr()),yc=Bn(ze());function Bn(e){return e&&e.__esModule?e:{default:e}}var Fn,Xr,Zr=0,es=0;function Rc(e,t,r){let s=t&&r||0,i=t||new Array(16);e=e||{};let n=e.node||Fn,o=e.clockseq!==void 0?e.clockseq:Xr;if(n==null||o==null){let d=e.random||(e.rng||vc.default)();n==null&&(n=Fn=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),o==null&&(o=Xr=(d[6]<<8|d[7])&16383)}let a=e.msecs!==void 0?e.msecs:Date.now(),u=e.nsecs!==void 0?e.nsecs:es+1,c=a-Zr+(u-es)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||a>Zr)&&e.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Zr=a,es=u,Xr=o,a+=122192928e5;let l=((a&268435455)*1e4+u)%4294967296;i[s++]=l>>>24&255,i[s++]=l>>>16&255,i[s++]=l>>>8&255,i[s++]=l&255;let h=a/4294967296*1e4&268435455;i[s++]=h>>>8&255,i[s++]=h&255,i[s++]=h>>>24&15|16,i[s++]=h>>>16&255,i[s++]=o>>>8|128,i[s++]=o&255;for(let d=0;d<6;++d)i[s+d]=n[d];return t||(0,yc.default)(i)}var Ec=Rc;Jt.default=Ec});var ts=f(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.default=void 0;var bc=Cc(Ke());function Cc(e){return e&&e.__esModule?e:{default:e}}function Ac(e){if(!(0,bc.default)(e))throw TypeError("Invalid UUID");let t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=t&255,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=t&255,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=t&255,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=t&255,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=t&255,r}var Tc=Ac;Xt.default=Tc});var rs=f(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.default=Hc;le.URL=le.DNS=void 0;var wc=Gn(ze()),Sc=Gn(ts());function Gn(e){return e&&e.__esModule?e:{default:e}}function xc(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var Vn="6ba7b810-9dad-11d1-80b4-00c04fd430c8";le.DNS=Vn;var Yn="6ba7b811-9dad-11d1-80b4-00c04fd430c8";le.URL=Yn;function Hc(e,t,r){function s(i,n,o,a){if(typeof i=="string"&&(i=xc(i)),typeof n=="string"&&(n=(0,Sc.default)(n)),n.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+i.length);if(u.set(n),u.set(i,n.length),u=r(u),u[6]=u[6]&15|t,u[8]=u[8]&63|128,o){a=a||0;for(let c=0;c<16;++c)o[a+c]=u[c];return o}return(0,wc.default)(u)}try{s.name=e}catch(i){}return s.DNS=Vn,s.URL=Yn,s}});var Kn=f(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.default=void 0;var Pc=Oc(require("crypto"));function Oc(e){return e&&e.__esModule?e:{default:e}}function Dc(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),Pc.default.createHash("md5").update(e).digest()}var qc=Dc;Zt.default=qc});var Qn=f(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.default=void 0;var Mc=zn(rs()),jc=zn(Kn());function zn(e){return e&&e.__esModule?e:{default:e}}var Lc=(0,Mc.default)("v3",48,jc.default),Nc=Lc;er.default=Nc});var Xn=f(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.default=void 0;var Ic=Jn(Jr()),$c=Jn(ze());function Jn(e){return e&&e.__esModule?e:{default:e}}function kc(e,t,r){e=e||{};let s=e.random||(e.rng||Ic.default)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=s[i];return t}return(0,$c.default)(s)}var Uc=kc;tr.default=Uc});var Zn=f(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.default=void 0;var Bc=Fc(require("crypto"));function Fc(e){return e&&e.__esModule?e:{default:e}}function Wc(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),Bc.default.createHash("sha1").update(e).digest()}var Gc=Wc;rr.default=Gc});var ti=f(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.default=void 0;var Vc=ei(rs()),Yc=ei(Zn());function ei(e){return e&&e.__esModule?e:{default:e}}var Kc=(0,Vc.default)("v5",80,Yc.default),zc=Kc;sr.default=zc});var ri=f(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.default=void 0;var Qc="00000000-0000-0000-0000-000000000000";nr.default=Qc});var si=f(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.default=void 0;var Jc=Xc(Ke());function Xc(e){return e&&e.__esModule?e:{default:e}}function Zc(e){if(!(0,Jc.default)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}var el=Zc;ir.default=el});var ni=f(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});Object.defineProperty(W,"v1",{enumerable:!0,get:function(){return tl.default}});Object.defineProperty(W,"v3",{enumerable:!0,get:function(){return rl.default}});Object.defineProperty(W,"v4",{enumerable:!0,get:function(){return sl.default}});Object.defineProperty(W,"v5",{enumerable:!0,get:function(){return nl.default}});Object.defineProperty(W,"NIL",{enumerable:!0,get:function(){return il.default}});Object.defineProperty(W,"version",{enumerable:!0,get:function(){return ol.default}});Object.defineProperty(W,"validate",{enumerable:!0,get:function(){return al.default}});Object.defineProperty(W,"stringify",{enumerable:!0,get:function(){return ul.default}});Object.defineProperty(W,"parse",{enumerable:!0,get:function(){return cl.default}});var tl=K(Wn()),rl=K(Qn()),sl=K(Xn()),nl=K(ti()),il=K(ri()),ol=K(si()),al=K(Ke()),ul=K(ze()),cl=K(ts());function K(e){return e&&e.__esModule?e:{default:e}}});var ss=f(Qe=>{"use strict";var ii=Qe&&Qe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Qe,"__esModule",{value:!0});var ll=ii(require("url")),hl=ii(require("querystring")),oi=class{constructor(t,r,s){}cache(t){}redirect(t,r){}_readRedirectParams(t,r){let{statusCode:s=302,query:i={}}=typeof r=="number"?{statusCode:r}:r,n={},o=ll.default.parse(t);return(o==null?void 0:o.search)&&(t=t.substr(0,t.length-o.search.length),n=hl.default.parse(o.query)),{to:t,statusCode:s,query:b(b({},n),i)}}proxy(t,r){}render(t){}stream(t){}serveStatic(t,r){}updatePath(t){}rewrite(t,r){}setRequestHeader(t,r){}updateRequestHeader(t,r,s){}removeRequestHeader(t){}setUpstreamResponseHeader(t,r){}updateUpstreamResponseHeader(t,r,s){}removeUpstreamResponseHeader(t){}setResponseHeader(t,r){}updateResponseHeader(t,r,s){}removeResponseHeader(t){}addResponseCookie(t,r,s){}updateResponseCookie(t,r,s){}removeResponseCookie(t){}addUpstreamResponseCookie(t,r,s){}updateUpstreamResponseCookie(t,r,s){}removeUpstreamResponseCookie(t){}send(t,r,s){}compute(t){}serviceWorker(t){}allowCors(t){}appShell(t){}renderWithApp(t){}};Qe.BaseResponseWriter=oi});var Je=f(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});var dl=e=>e;function fl(e,t,r=dl){let s={};return Object.entries(e).every(([i,n])=>{let o=t[r(i)];if(n===null)return o===void 0;if(typeof n=="string"){if(typeof o=="string"&&ai(n)){let a=ui(n);return s[a]=o,!0}n=new RegExp(`^${n}$`,"i")}return ci(n,o)})&&s}xe.matchCriteriaRegexObjectWithRequestObject=fl;function ai(e){return typeof e=="string"&&/^:\w+$/.test(e)}xe.isParamMatcher=ai;function ui(e){return e.slice(1)}xe.paramMatcherToParam=ui;function ci(e,t){return t==null?!1:(e.global&&(e=new RegExp(e)),Array.isArray(t)?t.some(r=>e.test(r)):e.test(t))}xe.testRegExp=ci});var is=f(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});function pl(e,t){let r={};for(let[s,i]of Object.entries(e))r[s]=t(i,s);return r}ns.default=pl});var li=f(Xe=>{"use strict";var gl=Xe&&Xe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xe,"__esModule",{value:!0});var _l=Je(),ml=gl(is()),he=class{constructor(t){this.entries=t||[]}get cacheableEntries(){return this.entries.filter(he.isEntryCacheable)}get spaRoutes(){return this.cacheableEntries.filter(({cacheOptions:t})=>t.browser&&t.browser.spa).map(({route:t})=>new RegExp(t,"i"))}shouldPrefetch(t){let r=!1;return this.entries.some(s=>he.entryMatches(s,t)?(r=he.isEntryCacheable(s)||!!s.cacheOptions.prefetchUpstreamRequests,r||s.returnsResponse):!1),r}static entryMatches(t,r){return new RegExp(t.route,"i").test(r.pathname)&&_l.matchCriteriaRegexObjectWithRequestObject(ml.default(t.query||{},s=>s?new RegExp(s,"i"):null),Object.fromEntries(Array.from(r.searchParams.entries())))&&(t.protocol?new RegExp(t.protocol,"i").test(r.protocol):!0)}static isEntryCacheable({cacheOptions:t}){return!!(t.browser&&(t.browser.serviceWorkerSeconds||0)>0&&t.edge&&(t.edge.maxAgeSeconds||0)>0)}static fromEntries(t){return new he(t)}toJSON(){return JSON.stringify(this.entries)}};Xe.default=he});var fi=f(Ze=>{"use strict";var hi=Ze&&Ze.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ze,"__esModule",{value:!0});var vl=ss(),yl=hi(li()),Rl=hi(is());function El(e){let t=new yl.default,r=s=>{if(s!==void 0)return s instanceof RegExp?s.source:s};for(let s of e.routeGroups.getRoutes()){let i=new di;s.handler(i);let n={criteriaPath:s.criteria.path,route:s.toRegexString(),method:r(s.criteria.method),protocol:r(s.criteria.protocol),cacheOptions:i.cacheOptions,returnsResponse:i.returnsResponse};s.criteria.query&&(n.query=Rl.default(s.criteria.query,o=>o?o.source:null)),!(s.criteria.headers||s.criteria.cookies)&&t.entries.push(n)}return t}Ze.default=El;var di=class extends vl.BaseResponseWriter{constructor(){super(...arguments);this.response={},this.request={},this.cacheOptions={},this.returnsResponse=!1,this.doesReturnResponse=()=>this.returnsResponse=!0,this.cache=t=>{this.cacheOptions=t},this.send=this.doesReturnResponse,this.compute=this.doesReturnResponse,this.proxy=this.doesReturnResponse,this.redirect=this.doesReturnResponse,this.render=this.doesReturnResponse,this.serveStatic=this.doesReturnResponse,this.serviceWorker=this.doesReturnResponse,this.renderWithApp=this.doesReturnResponse,this.appShell=this.doesReturnResponse,this.stream=this.doesReturnResponse}}});var pi=f(et=>{"use strict";var bl=et&&et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(et,"__esModule",{value:!0});var Cl=bl(fi());function Al(e){Tl(e);try{require("@layer0/devtools/addBuiltInRoutes")(e)}catch(t){if(t.code!=="MODULE_NOT_FOUND")throw t}}et.default=Al;function Tl(e){e.match("/__layer0__/cache-manifest.js",({cache:t,setResponseHeader:r,send:s,allowCors:i})=>{t({edge:{maxAgeSeconds:60*60*24*365},browser:{maxAgeSeconds:60*60}}),r("content-type","text/javascript"),i(),s(()=>`self.__LAYER0_CACHE_MANIFEST__=${Cl.default(e).toJSON()}`)})}});var gi=f(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});var wl=new Set(["cache","setRequestHeader","updateRequestHeader","removeRequestHeader","setResponseHeader","updateResponseHeader","removeResponseHeader","setUpstreamResponseHeader","updateUpstreamResponseHeader","removeUpstreamResponseHeader","addResponseCookie","updateResponseCookie","removeResponseCookie","addUpstreamResponseCookie","updateUpstreamResponseCookie","removeUpstreamResponseCookie"]),Sl=e=>{let t=(r,s)=>async function(...i){if(!!r.runningImmediately)return await r[s](...i)}.bind(r);return new Proxy(e,{get:(r,s)=>s==="serveStatic"?xl(r,r.serveStatic):wl.has(s.toString())?t(r,s):r[s]})};os.default={create:Sl};function xl(e,t){return async(r,s={})=>{if(e.runningImmediately)return t.call(e,r,s);if(s.onNotFound)e.setCreateResponseAction(()=>e.runImmediately(()=>s.onNotFound(e)));else throw new Error("Should not get to serveStatic without onNotFound when running behind the edge.")}}});var or=f(as=>{"use strict";Object.defineProperty(as,"__esModule",{value:!0});function Hl(e,t){let r=e,s=t.split(".");for(let i of s){if(typeof r=="undefined")return;r=r[i]}return r}as.default=Hl});var _i=f(tt=>{"use strict";var Pl=tt&&tt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(tt,"__esModule",{value:!0});var Ol=Pl(or());function Dl(e,t){return!!Ol.default(e,t)}tt.default=Dl});var Ri=f((q_,yi)=>{"use strict";var ql=function(t){return Ml(t)&&!jl(t)};function Ml(e){return!!e&&typeof e=="object"}function jl(e){var t=Object.prototype.toString.call(e);return t==="[object RegExp]"||t==="[object Date]"||Il(e)}var Ll=typeof Symbol=="function"&&Symbol.for,Nl=Ll?Symbol.for("react.element"):60103;function Il(e){return e.$$typeof===Nl}function $l(e){return Array.isArray(e)?[]:{}}function rt(e,t){return t.clone!==!1&&t.isMergeableObject(e)?He($l(e),e,t):e}function kl(e,t,r){return e.concat(t).map(function(s){return rt(s,r)})}function Ul(e,t){if(!t.customMerge)return He;var r=t.customMerge(e);return typeof r=="function"?r:He}function Bl(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return e.propertyIsEnumerable(t)}):[]}function mi(e){return Object.keys(e).concat(Bl(e))}function vi(e,t){try{return t in e}catch(r){return!1}}function Fl(e,t){return vi(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))}function Wl(e,t,r){var s={};return r.isMergeableObject(e)&&mi(e).forEach(function(i){s[i]=rt(e[i],r)}),mi(t).forEach(function(i){Fl(e,i)||(vi(e,i)&&r.isMergeableObject(t[i])?s[i]=Ul(i,r)(e[i],t[i],r):s[i]=rt(t[i],r))}),s}function He(e,t,r){r=r||{},r.arrayMerge=r.arrayMerge||kl,r.isMergeableObject=r.isMergeableObject||ql,r.cloneUnlessOtherwiseSpecified=rt;var s=Array.isArray(t),i=Array.isArray(e),n=s===i;return n?s?r.arrayMerge(e,t,r):Wl(e,t,r):rt(t,r)}He.all=function(t,r){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(s,i){return He(s,i,r)},{})};var Gl=He;yi.exports=Gl});var wi=f(st=>{"use strict";var Vl=st&&st.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(st,"__esModule",{value:!0});var Ei=require("os"),ar=S(),Yl=Ye(),Kl=Vl(ue()),us={$id:"/domainOrIpSchema",type:"string"},bi={$id:"/backendObjectSchema",type:"object",properties:{domainOrIp:{$ref:us.$id},port:{type:"number",minimum:1,maximum:65535},hostHeader:{type:"string"},disableCheckCert:{type:"boolean"},firstByteTimeout:{type:"number"},basePath:{type:"string"}},additionalProperties:!1,required:["domainOrIp"]},Ci={$id:"/backendSchema",type:"object",patternProperties:{"^.*$":{oneOf:[{$ref:us.$id},{$ref:bi.$id}]}}},Ai={$id:"/layer0FileConfigurationSchema",type:"object",properties:{prerenderConcurrency:{type:"number"},production:{type:"boolean"},routes:{type:"string"},server:{type:"object",required:["path"],properties:{path:{type:"string"},export:{type:"string"}}},includeFiles:{type:"object"},sources:{type:"array",items:{type:"string"}},backends:{$ref:Ci.$id},includeNodeModules:{type:"boolean"},connector:{type:"string"}},additionalProperties:!1,required:[]},Ti=class{static validateLayer0FileConfiguration(t){var r;if(Yl.isCloud())return t;let s=Kl.default("ajv"),i=new s({allErrors:!0,schemas:[Ai,Ci,bi,us]}),n=[],o=i.getSchema(Ai.$id);if(((r=t.backends)===null||r===void 0?void 0:r.moov)!=null&&n.push({message:"is a reserved backend name",dataPath:".backends['moov']"}),t.backends&&t.backends[ar.BACKENDS.static]&&n.push({message:"is a reserved backend name",dataPath:`.backends.${ar.BACKENDS.static}`}),t.backends&&t.backends[ar.BACKENDS.js]&&n.push({message:"is a reserved backend name",dataPath:`.backends.${ar.BACKENDS.js}`}),!o(t)&&o.errors&&(n=[...n,...o.errors]),n.length){let a=n.map((u,c)=>{let l=`${c+1}) config${u.dataPath}: ${u.message}`;return u.keyword==="additionalProperties"&&(l+=` '${u.params.additionalProperty}'`),l}).join(Ei.EOL);throw new Error(`Layer0 configuration validation failed with errors: ${Ei.EOL}${a}`)}return t}};st.default=Ti});var de=f(ot=>{"use strict";var nt=ot&&ot.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ot,"__esModule",{value:!0});var zl=nt(or()),Ql=nt(_i()),Jl=nt(Ri()),Si=require("fs"),cs=require("path"),it=S(),Xl=nt(wi()),Zl=nt(ue()),xi=class{constructor(){this.defaults={production:!0,backends:{},includeNodeModules:!1,routes:["routes.js","routes.ts"].find(t=>Si.existsSync(cs.join(process.cwd(),t)))||"routes.js"}}get(t,r){if(this.has(t))return zl.default(this.values,t);if(typeof r!="undefined")return r;throw new Error(`Layer0 configuration key: "${t}" is not defined`)}has(t){return this.values||this.loadLayer0Config(),Ql.default(this.values,t)}get all(){return this.values||this.loadLayer0Config(),this.values}loadLayer0Config(){let t=this.loadFromFile(),r=this.loadFromEnv();this.values=Jl.default.all([{},this.defaults,t,r])}loadFromFile(){let t=[cs.join(process.cwd(),it.LAYER0_CONFIG_FILE),cs.join(process.cwd(),it.LAYER0_CONFIG_FILE.replace(".js",".cjs"))].find(Si.existsSync);if(t)try{let r=Zl.default(t);return Xl.default.validateLayer0FileConfiguration(r)}catch(r){throw new Error(`Failed to load ${t}: ${r.message}`)}return{}}loadFromEnv(){if(process.env[it.LAYER0_ENV_VARIABLES.config])try{return JSON.parse(process.env[it.LAYER0_ENV_VARIABLES.config])}catch(t){throw new Error(`Layer0 configuration variable: ${it.LAYER0_ENV_VARIABLES.config}, is not parsable as json`)}return{}}};ot.default=new xi});var cr=f(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});function eh(e){return`${e.ignoreCase?"(?i)":""}${e.source}`.replace(/\\\//g,"/")}ur.default=eh;function th(e){let t=e.indexOf("(?i)")===0;return t&&(e=e.slice("(?i)".length)),new RegExp(e.replace(/\//g,"/"),t?"i":"")}ur.fromEdgeRegex=th});var Hi=f(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});function rh(e){return new RegExp(`^${e}$`,"i")}ls.default=rh});var Oi=f(at=>{"use strict";var sh=at&&at.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(at,"__esModule",{value:!0});var Pi=sh(cr());function nh(e){let t;return e===null?t=null:typeof e=="string"?t=Pi.default(new RegExp(`^${e}$`,"i")):t=Pi.default(e),t}at.default=nh});var ds=f(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.default=(e,t)=>{let r=e;if(/(^|[^$]){/.test(e))throw new Error(`{variable} syntax in the path option is no longer supported, use :variable instead (${e})`);for(let s in t){let i=t[s];Array.isArray(i)&&(i=i.join("/")),r=r.replace(new RegExp(`:${s}(\\([^)]*\\))?[?*]?`,"g"),i===void 0?"":i)}return r=r.replace(/:\w+(\*|\?)?/,""),r=r.replace("\\?","?"),r=r.replace(/\/+/g,"/").replace(/^([^:]+:)\//gi,"$1//"),r}});var lr=f(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.pathToRegexp=D.tokensToRegexp=D.regexpToFunction=D.match=D.tokensToFunction=D.compile=D.parse=void 0;function ih(e){for(var t=[],r=0;r<e.length;){var s=e[r];if(s==="*"||s==="+"||s==="?"){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(s==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(s==="{"){t.push({type:"OPEN",index:r,value:e[r++]});continue}if(s==="}"){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(s===":"){for(var i="",n=r+1;n<e.length;){var o=e.charCodeAt(n);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||o===95){i+=e[n++];continue}break}if(!i)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:i}),r=n;continue}if(s==="("){var a=1,u="",n=r+1;if(e[n]==="?")throw new TypeError('Pattern cannot start with "?" at '+n);for(;n<e.length;){if(e[n]==="\\"){u+=e[n++]+e[n++];continue}if(e[n]===")"){if(a--,a===0){n++;break}}else if(e[n]==="("&&(a++,e[n+1]!=="?"))throw new TypeError("Capturing groups are not allowed at "+n);u+=e[n++]}if(a)throw new TypeError("Unbalanced pattern at "+r);if(!u)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:u}),r=n;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function fs(e,t){t===void 0&&(t={});for(var r=ih(e),s=t.prefixes,i=s===void 0?"./":s,n="[^"+Pe(t.delimiter||"/#?")+"]+?",o=[],a=0,u=0,c="",l=function(Y){if(u<r.length&&r[u].type===Y)return r[u++].value},h=function(Y){var Ge=l(Y);if(Ge!==void 0)return Ge;var Tn=r[u],Mu=Tn.type,ju=Tn.index;throw new TypeError("Unexpected "+Mu+" at "+ju+", expected "+Y)},d=function(){for(var Y="",Ge;Ge=l("CHAR")||l("ESCAPED_CHAR");)Y+=Ge;return Y};u<r.length;){var p=l("CHAR"),g=l("NAME"),y=l("PATTERN");if(g||y){var m=p||"";i.indexOf(m)===-1&&(c+=m,m=""),c&&(o.push(c),c=""),o.push({name:g||a++,prefix:m,suffix:"",pattern:y||n,modifier:l("MODIFIER")||""});continue}var F=p||l("ESCAPED_CHAR");if(F){c+=F;continue}c&&(o.push(c),c="");var k=l("OPEN");if(k){var m=d(),Ft=l("NAME")||"",ne=l("PATTERN")||"",Ur=d();h("CLOSE"),o.push({name:Ft||(ne?a++:""),pattern:Ft&&!ne?n:ne,prefix:m,suffix:Ur,modifier:l("MODIFIER")||""});continue}h("END")}return o}D.parse=fs;function oh(e,t){return Di(fs(e,t),t)}D.compile=oh;function Di(e,t){t===void 0&&(t={});var r=ps(t),s=t.encode,i=s===void 0?function(u){return u}:s,n=t.validate,o=n===void 0?!0:n,a=e.map(function(u){if(typeof u=="object")return new RegExp("^(?:"+u.pattern+")$",r)});return function(u){for(var c="",l=0;l<e.length;l++){var h=e[l];if(typeof h=="string"){c+=h;continue}var d=u?u[h.name]:void 0,p=h.modifier==="?"||h.modifier==="*",g=h.modifier==="*"||h.modifier==="+";if(Array.isArray(d)){if(!g)throw new TypeError('Expected "'+h.name+'" to not repeat, but got an array');if(d.length===0){if(p)continue;throw new TypeError('Expected "'+h.name+'" to not be empty')}for(var y=0;y<d.length;y++){var m=i(d[y],h);if(o&&!a[l].test(m))throw new TypeError('Expected all "'+h.name+'" to match "'+h.pattern+'", but got "'+m+'"');c+=h.prefix+m+h.suffix}continue}if(typeof d=="string"||typeof d=="number"){var m=i(String(d),h);if(o&&!a[l].test(m))throw new TypeError('Expected "'+h.name+'" to match "'+h.pattern+'", but got "'+m+'"');c+=h.prefix+m+h.suffix;continue}if(!p){var F=g?"an array":"a string";throw new TypeError('Expected "'+h.name+'" to be '+F)}}return c}}D.tokensToFunction=Di;function ah(e,t){var r=[],s=gs(e,r,t);return qi(s,r,t)}D.match=ah;function qi(e,t,r){r===void 0&&(r={});var s=r.decode,i=s===void 0?function(n){return n}:s;return function(n){var o=e.exec(n);if(!o)return!1;for(var a=o[0],u=o.index,c=Object.create(null),l=function(d){if(o[d]===void 0)return"continue";var p=t[d-1];p.modifier==="*"||p.modifier==="+"?c[p.name]=o[d].split(p.prefix+p.suffix).map(function(g){return i(g,p)}):c[p.name]=i(o[d],p)},h=1;h<o.length;h++)l(h);return{path:a,index:u,params:c}}}D.regexpToFunction=qi;function Pe(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function ps(e){return e&&e.sensitive?"":"i"}function uh(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,s=0,i=r.exec(e.source);i;)t.push({name:i[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(e.source);return e}function ch(e,t,r){var s=e.map(function(i){return gs(i,t,r).source});return new RegExp("(?:"+s.join("|")+")",ps(r))}function lh(e,t,r){return Mi(fs(e,r),t,r)}function Mi(e,t,r){r===void 0&&(r={});for(var s=r.strict,i=s===void 0?!1:s,n=r.start,o=n===void 0?!0:n,a=r.end,u=a===void 0?!0:a,c=r.encode,l=c===void 0?function(Y){return Y}:c,h="["+Pe(r.endsWith||"")+"]|$",d="["+Pe(r.delimiter||"/#?")+"]",p=o?"^":"",g=0,y=e;g<y.length;g++){var m=y[g];if(typeof m=="string")p+=Pe(l(m));else{var F=Pe(l(m.prefix)),k=Pe(l(m.suffix));if(m.pattern)if(t&&t.push(m),F||k)if(m.modifier==="+"||m.modifier==="*"){var Ft=m.modifier==="*"?"?":"";p+="(?:"+F+"((?:"+m.pattern+")(?:"+k+F+"(?:"+m.pattern+"))*)"+k+")"+Ft}else p+="(?:"+F+"("+m.pattern+")"+k+")"+m.modifier;else p+="("+m.pattern+")"+m.modifier;else p+="(?:"+F+k+")"+m.modifier}}if(u)i||(p+=d+"?"),p+=r.endsWith?"(?="+h+")":"$";else{var ne=e[e.length-1],Ur=typeof ne=="string"?d.indexOf(ne[ne.length-1])>-1:ne===void 0;i||(p+="(?:"+d+"(?="+h+"))?"),Ur||(p+="(?="+d+"|"+h+")")}return new RegExp(p,ps(r))}D.tokensToRegexp=Mi;function gs(e,t,r){return e instanceof RegExp?uh(e,t):Array.isArray(e)?ch(e,t,r):lh(e,t,r)}D.pathToRegexp=gs});var Li=f(Oe=>{"use strict";var hh=Oe&&Oe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Oe,"__esModule",{value:!0});var dh=hh(ds()),fh=lr();function ph(e,t){if(e==null)return t;let r=ji(e);return dh.default(t,r)}Oe.default=ph;function ji(e){if(!e)return{};let t=e.match(/https?:\/\/[^/]+(.*)/);t&&(e=`/${t[1]}`);let r=1,s={};return fh.parse(e).forEach(i=>{typeof i!="string"&&(s[i.name]=`\\${r++}`)}),s}Oe.getBackReferences=ji});var Ni=f(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});function gh(e){return e?typeof e.length=="number"?!e.length:!(typeof e=="object"&&Object.keys(e).length):!0}_s.default=gh});var $i=f(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});var Ii=class extends Error{constructor(t){super(t.message);this.type="BackendFetchError",this.cause=t}};ms.default=Ii});var Rs=f(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});var vs="__";function _h(e,t){let r=new URL(e,`https://${vs}`).searchParams,s=new URL(t,`https://${vs}`);return r.forEach((i,n)=>{s.searchParams.get(n)||s.searchParams.set(n,i)}),s.hostname===vs?`${s.pathname}${s.search}`:s.toString()}ys.default=_h});var Fi=f(ut=>{"use strict";var hr=ut&&ut.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ut,"__esModule",{value:!0});var mh=require("url"),ki=hr(require("https")),vh=hr(require("http")),Ui=require("path"),yh=hr($i()),Rh=hr(Rs()),Eh=S(),bh=["transfer-encoding","content-length"],Bi=class{constructor(t){this.config=t}async fetch(t,r,s){let{path:i,headers:n}=s||{},o=this.getProxyTarget(t,i),a=this.getProxyRequestOptions(o,t,n);return new Promise((u,c)=>{let h=(o.protocol==="https:"?ki.default:vh.default).request(a,d=>{let p=[];d.on("data",g=>p.push(g)).on("end",()=>{Object.entries(d.headers).filter(([g])=>!bh.includes(g.toLowerCase())).forEach(([g,y])=>{try{r.setHeader(g,y)}catch(m){console.warn(`Could not relay upstream response header ${g} with value ${y}`,m)}}),r.statusCode=d.statusCode,r.statusMessage=d.statusMessage,r.body=Buffer.concat(p),u(void 0)})});h.on("error",d=>c(new yh.default(d))),h.end(t.body)})}getProxyTarget(t,r){let s=r?Rh.default(t.url,r):t.url,{domainOrIp:i,basePath:n,port:o}=this.config;if(n&&(s=Ui.join(n,s)),i){let a=i.match(/^127.0.0.1(:\d+)?$/)?"http":"https",u=`${i}${o?`:${o}`:""}`;s=`${a}://${Ui.join(u,s)}`}return mh.parse(s,!0)}isLocal(t){return t.hostname===Eh.JS_BACKEND_HOSTNAME}getProxyRequestOptions(t,r,s){let i=null;this.config.disableCheckCert&&t.protocol==="https:"&&(i=new ki.default.Agent({rejectUnauthorized:!1}));let n=w(b(b({},r.headers),s),{host:this.config.hostHeader||r.headers.host});return this.isLocal(t)&&(n["x-forwarded-proto"]=r.secure?"https":"http"),w(b({},t),{method:r.method,timeout:this.config.firstByteTimeout||0,agent:i,body:r.body,headers:n})}};ut.default=Bi});var fr=f(Es=>{"use strict";Es.parse=wh;Es.serialize=Sh;var Ch=decodeURIComponent,Ah=encodeURIComponent,Th=/; */,dr=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function wh(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var r={},s=t||{},i=e.split(Th),n=s.decode||Ch,o=0;o<i.length;o++){var a=i[o],u=a.indexOf("=");if(!(u<0)){var c=a.substr(0,u).trim(),l=a.substr(++u,a.length).trim();l[0]=='"'&&(l=l.slice(1,-1)),r[c]==null&&(r[c]=xh(l,n))}}return r}function Sh(e,t,r){var s=r||{},i=s.encode||Ah;if(typeof i!="function")throw new TypeError("option encode is invalid");if(!dr.test(e))throw new TypeError("argument name is invalid");var n=i(t);if(n&&!dr.test(n))throw new TypeError("argument val is invalid");var o=e+"="+n;if(s.maxAge!=null){var a=s.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(a)}if(s.domain){if(!dr.test(s.domain))throw new TypeError("option domain is invalid");o+="; Domain="+s.domain}if(s.path){if(!dr.test(s.path))throw new TypeError("option path is invalid");o+="; Path="+s.path}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(o+="; HttpOnly"),s.secure&&(o+="; Secure"),s.sameSite){var u=typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite;switch(u){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return o}function xh(e,t){try{return t(e)}catch(r){return e}}});var Wi=f(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});function Hh(e){return e}bs.default=Hh});var Cs=f(ct=>{"use strict";var Gi=ct&&ct.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ct,"__esModule",{value:!0});var Ph=Gi(fr()),Oh=require("querystring"),Dh=Gi(Wi());function Vi(e,t,r){if(typeof r=="string")return qh(e,t,r);if(!Array.isArray(r))return r;let s=[];return r.forEach(i=>{s.push(Vi(e,t,i))}),s}ct.default=Vi;function qh(e,t,r){let s=r.replace(/\\\${/g,"--backslashdollar--").replace(/\${/g,"--separator--${").split("--separator--"),i={};(e==null?void 0:e.headers.cookie)&&(i=Ph.default.parse(e.headers.cookie,{decode:Dh.default}));let n={};if(e==null?void 0:e.url){let c=e.url.indexOf("?");if(c>=0){let l=e.url.substring(c+1);n=Oh.parse(l)}}let o=[],a="${req:".length,u="${query:".length;return s.forEach(c=>{if(e){c=c.replace(/\${method}/,e.method),c=c.replace(/\${path}/,e.path),c=c.replace(/\${url}/,e.url);let h=c.search(/\${query:/);if(h>=0){let p=c.substring(h+u),g=p.indexOf("}");if(g<=0)throw new Error(`Cannot interpolate substring "${c}" of value "${r}" (1)`);p=p.substring(0,g);let y=n[p]||"";Array.isArray(y)&&(y=y[0]),c=c.replace(/\${query:.*?}/,y)}let d=c.search(/\${req:/);if(d>=0){let p=c.substring(d+a),g=p.indexOf("}");if(g<=0)throw new Error(`Cannot interpolate substring "${c}" of value "${r}" (2)`);p=p.substring(0,g);let y="";if(p.indexOf("cookie:")===0){let m=p.split(":")[1];y=i[m]||""}else y=e.headers[p]||"";c=c.replace(/\${req:.*?}/,y)}}let l=c.search(/\${res:/);if(l>=0){if(!t)throw new Error(`Cannot interpolate response parameter "${c}" during receive phase`);let h=c.substring(l+a),d=h.indexOf("}");if(d<=0)throw new Error(`Cannot interpolate substring "${c}" of value "${r}" (3)`);h=h.substring(0,d),c=c.replace(/\${res:.*?}/,t.getHeader(h)||"")}if(c.search(/\${/)>=0)throw new Error(`Cannot interpolate substring "${c}" of "${r}" (4)`);o.push(c)}),o.join("").replace(/--backslashdollar--/g,"${")}});var Ki=f((z_,As)=>{"use strict";var Mh=Object.prototype.hasOwnProperty,j="~";function lt(){}Object.create&&(lt.prototype=Object.create(null),new lt().__proto__||(j=!1));function jh(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function Yi(e,t,r,s,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var n=new jh(r,s||e,i),o=j?j+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],n]:e._events[o].push(n):(e._events[o]=n,e._eventsCount++),e}function pr(e,t){--e._eventsCount==0?e._events=new lt:delete e._events[t]}function q(){this._events=new lt,this._eventsCount=0}q.prototype.eventNames=function(){var t=[],r,s;if(this._eventsCount===0)return t;for(s in r=this._events)Mh.call(r,s)&&t.push(j?s.slice(1):s);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t};q.prototype.listeners=function(t){var r=j?j+t:t,s=this._events[r];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,n=s.length,o=new Array(n);i<n;i++)o[i]=s[i].fn;return o};q.prototype.listenerCount=function(t){var r=j?j+t:t,s=this._events[r];return s?s.fn?1:s.length:0};q.prototype.emit=function(t,r,s,i,n,o){var a=j?j+t:t;if(!this._events[a])return!1;var u=this._events[a],c=arguments.length,l,h;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,r),!0;case 3:return u.fn.call(u.context,r,s),!0;case 4:return u.fn.call(u.context,r,s,i),!0;case 5:return u.fn.call(u.context,r,s,i,n),!0;case 6:return u.fn.call(u.context,r,s,i,n,o),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var d=u.length,p;for(h=0;h<d;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,r);break;case 3:u[h].fn.call(u[h].context,r,s);break;case 4:u[h].fn.call(u[h].context,r,s,i);break;default:if(!l)for(p=1,l=new Array(c-1);p<c;p++)l[p-1]=arguments[p];u[h].fn.apply(u[h].context,l)}}return!0};q.prototype.on=function(t,r,s){return Yi(this,t,r,s,!1)};q.prototype.once=function(t,r,s){return Yi(this,t,r,s,!0)};q.prototype.removeListener=function(t,r,s,i){var n=j?j+t:t;if(!this._events[n])return this;if(!r)return pr(this,n),this;var o=this._events[n];if(o.fn)o.fn===r&&(!i||o.once)&&(!s||o.context===s)&&pr(this,n);else{for(var a=0,u=[],c=o.length;a<c;a++)(o[a].fn!==r||i&&!o[a].once||s&&o[a].context!==s)&&u.push(o[a]);u.length?this._events[n]=u.length===1?u[0]:u:pr(this,n)}return this};q.prototype.removeAllListeners=function(t){var r;return t?(r=j?j+t:t,this._events[r]&&pr(this,r)):(this._events=new lt,this._eventsCount=0),this};q.prototype.off=q.prototype.removeListener;q.prototype.addListener=q.prototype.on;q.prefixed=j;q.EventEmitter=q;typeof As!="undefined"&&(As.exports=q)});var Qi=f((Q_,zi)=>{"use strict";zi.exports=function(t,r){if(r=r.split(":")[0],t=+t,!t)return!1;switch(r){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return!1}return t!==0}});var gr=f(Xi=>{var z=Xi,Lh=require("url"),Ji=require("util")._extend,Nh=Qi(),Ih=/(^|,)\s*upgrade\s*($|,)/i,Ts=/^https|wss/;z.isSSL=Ts;z.setupOutgoing=function(e,t,r,s){e.port=t[s||"target"].port||(Ts.test(t[s||"target"].protocol)?443:80),["host","hostname","socketPath","pfx","key","passphrase","cert","ca","ciphers","secureProtocol"].forEach(function(a){e[a]=t[s||"target"][a]}),e.method=t.method||r.method,e.headers=Ji({},r.headers),t.headers&&Ji(e.headers,t.headers),t.auth&&(e.auth=t.auth),t.ca&&(e.ca=t.ca),Ts.test(t[s||"target"].protocol)&&(e.rejectUnauthorized=typeof t.secure=="undefined"?!0:t.secure),e.agent=t.agent||!1,e.localAddress=t.localAddress,e.agent||(e.headers=e.headers||{},(typeof e.headers.connection!="string"||!Ih.test(e.headers.connection))&&(e.headers.connection="close"));var i=t[s||"target"],n=i&&t.prependPath!==!1&&i.path||"",o=t.toProxy?r.url:Lh.parse(r.url).path||"";return o=t.ignorePath?"":o,e.path=z.urlJoin(n,o),t.changeOrigin&&(e.headers.host=Nh(e.port,t[s||"target"].protocol)&&!$h(e.host)?e.host+":"+e.port:e.host),e};z.setupSocket=function(e){return e.setTimeout(0),e.setNoDelay(!0),e.setKeepAlive(!0,0),e};z.getPort=function(e){var t=e.headers.host?e.headers.host.match(/:(\d+)/):"";return t?t[1]:z.hasEncryptedConnection(e)?"443":"80"};z.hasEncryptedConnection=function(e){return Boolean(e.connection.encrypted||e.connection.pair)};z.urlJoin=function(){var e=Array.prototype.slice.call(arguments),t=e.length-1,r=e[t],s=r.split("?"),i;return e[t]=s.shift(),i=[e.filter(Boolean).join("/").replace(/\/+/g,"/").replace("http:/","http://").replace("https:/","https://")],i.push.apply(i,s),i.join("?")};z.rewriteCookieProperty=function e(t,r,s){return Array.isArray(t)?t.map(function(i){return e(i,r,s)}):t.replace(new RegExp("(;\\s*"+s+"=)([^;]+)","i"),function(i,n,o){var a;if(o in r)a=r[o];else if("*"in r)a=r["*"];else return i;return a?n+a:""})};function $h(e){return!!~e.indexOf(":")}});var ro=f((X_,to)=>{var Zi=require("url"),eo=gr(),kh=/^201|30(1|2|7|8)$/;to.exports={removeChunked:function(t,r,s){t.httpVersion==="1.0"&&delete s.headers["transfer-encoding"]},setConnection:function(t,r,s){t.httpVersion==="1.0"?s.headers.connection=t.headers.connection||"close":t.httpVersion!=="2.0"&&!s.headers.connection&&(s.headers.connection=t.headers.connection||"keep-alive")},setRedirectHostRewrite:function(t,r,s,i){if((i.hostRewrite||i.autoRewrite||i.protocolRewrite)&&s.headers.location&&kh.test(s.statusCode)){var n=Zi.parse(i.target),o=Zi.parse(s.headers.location);if(n.host!=o.host)return;i.hostRewrite?o.host=i.hostRewrite:i.autoRewrite&&(o.host=t.headers.host),i.protocolRewrite&&(o.protocol=i.protocolRewrite),s.headers.location=o.format()}},writeHeaders:function(t,r,s,i){var n=i.cookieDomainRewrite,o=i.cookiePathRewrite,a=i.preserveHeaderKeyCase,u,c=function(d,p){p!=null&&(n&&d.toLowerCase()==="set-cookie"&&(p=eo.rewriteCookieProperty(p,n,"domain")),o&&d.toLowerCase()==="set-cookie"&&(p=eo.rewriteCookieProperty(p,o,"path")),r.setHeader(String(d).trim(),p))};if(typeof n=="string"&&(n={"*":n}),typeof o=="string"&&(o={"*":o}),a&&s.rawHeaders!=null){u={};for(var l=0;l<s.rawHeaders.length;l+=2){var h=s.rawHeaders[l];u[h.toLowerCase()]=h}}Object.keys(s.headers).forEach(function(d){var p=s.headers[d];a&&u&&(d=u[d]||d),c(d,p)})},writeStatusCode:function(t,r,s){s.statusMessage?(r.statusCode=s.statusCode,r.statusMessage=s.statusMessage):r.statusCode=s.statusCode}}});var no=f((Z_,so)=>{var ht=1e3,dt=ht*60,ft=dt*60,pt=ft*24,Uh=pt*365.25;so.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Bh(e);if(r==="number"&&isNaN(e)===!1)return t.long?Wh(e):Fh(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Bh(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!!t){var r=parseFloat(t[1]),s=(t[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*Uh;case"days":case"day":case"d":return r*pt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ft;case"minutes":case"minute":case"mins":case"min":case"m":return r*dt;case"seconds":case"second":case"secs":case"sec":case"s":return r*ht;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Fh(e){return e>=pt?Math.round(e/pt)+"d":e>=ft?Math.round(e/ft)+"h":e>=dt?Math.round(e/dt)+"m":e>=ht?Math.round(e/ht)+"s":e+"ms"}function Wh(e){return _r(e,pt,"day")||_r(e,ft,"hour")||_r(e,dt,"minute")||_r(e,ht,"second")||e+" ms"}function _r(e,t,r){if(!(e<t))return e<t*1.5?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}});var xs=f((E,io)=>{E=io.exports=Ss.debug=Ss.default=Ss;E.coerce=zh;E.disable=Yh;E.enable=Vh;E.enabled=Kh;E.humanize=no();E.names=[];E.skips=[];E.formatters={};var ws;function Gh(e){var t=0,r;for(r in e)t=(t<<5)-t+e.charCodeAt(r),t|=0;return E.colors[Math.abs(t)%E.colors.length]}function Ss(e){function t(){if(!!t.enabled){var r=t,s=+new Date,i=s-(ws||s);r.diff=i,r.prev=ws,r.curr=s,ws=s;for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];n[0]=E.coerce(n[0]),typeof n[0]!="string"&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(c,l){if(c==="%%")return c;a++;var h=E.formatters[l];if(typeof h=="function"){var d=n[a];c=h.call(r,d),n.splice(a,1),a--}return c}),E.formatArgs.call(r,n);var u=t.log||E.log||console.log.bind(console);u.apply(r,n)}}return t.namespace=e,t.enabled=E.enabled(e),t.useColors=E.useColors(),t.color=Gh(e),typeof E.init=="function"&&E.init(t),t}function Vh(e){E.save(e),E.names=[],E.skips=[];for(var t=(typeof e=="string"?e:"").split(/[\s,]+/),r=t.length,s=0;s<r;s++)!t[s]||(e=t[s].replace(/\*/g,".*?"),e[0]==="-"?E.skips.push(new RegExp("^"+e.substr(1)+"$")):E.names.push(new RegExp("^"+e+"$")))}function Yh(){E.enable("")}function Kh(e){var t,r;for(t=0,r=E.skips.length;t<r;t++)if(E.skips[t].test(e))return!1;for(t=0,r=E.names.length;t<r;t++)if(E.names[t].test(e))return!0;return!1}function zh(e){return e instanceof Error?e.stack||e.message:e}});var uo=f((L,ao)=>{L=ao.exports=xs();L.log=Xh;L.formatArgs=Jh;L.save=Zh;L.load=oo;L.useColors=Qh;L.storage=typeof chrome!="undefined"&&typeof chrome.storage!="undefined"?chrome.storage.local:ed();L.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Qh(){return typeof window!="undefined"&&window.process&&window.process.type==="renderer"?!0:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}L.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}};function Jh(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+L.humanize(this.diff),!!t){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var s=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(n){n!=="%%"&&(s++,n==="%c"&&(i=s))}),e.splice(i,0,r)}}function Xh(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function Zh(e){try{e==null?L.storage.removeItem("debug"):L.storage.debug=e}catch(t){}}function oo(){var e;try{e=L.storage.debug}catch(t){}return!e&&typeof process!="undefined"&&"env"in process&&(e=process.env.DEBUG),e}L.enable(oo());function ed(){try{return window.localStorage}catch(e){}}});var fo=f((x,ho)=>{var co=require("tty"),gt=require("util");x=ho.exports=xs();x.init=ad;x.log=nd;x.formatArgs=sd;x.save=id;x.load=lo;x.useColors=rd;x.colors=[6,2,3,4,5,1];x.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,n){return n.toUpperCase()}),s=process.env[t];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),e[r]=s,e},{});var De=parseInt(process.env.DEBUG_FD,10)||2;De!==1&&De!==2&&gt.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var td=De===1?process.stdout:De===2?process.stderr:od(De);function rd(){return"colors"in x.inspectOpts?Boolean(x.inspectOpts.colors):co.isatty(De)}x.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,gt.inspect(e,this.inspectOpts).split(`
`).map(function(t){return t.trim()}).join(" ")};x.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,gt.inspect(e,this.inspectOpts)};function sd(e){var t=this.namespace,r=this.useColors;if(r){var s=this.color,i="  [3"+s+";1m"+t+" [0m";e[0]=i+e[0].split(`
`).join(`
`+i),e.push("[3"+s+"m+"+x.humanize(this.diff)+"[0m")}else e[0]=new Date().toUTCString()+" "+t+" "+e[0]}function nd(){return td.write(gt.format.apply(gt,arguments)+`
`)}function id(e){e==null?delete process.env.DEBUG:process.env.DEBUG=e}function lo(){return process.env.DEBUG}function od(e){var t,r=process.binding("tty_wrap");switch(r.guessHandleType(e)){case"TTY":t=new co.WriteStream(e),t._type="tty",t._handle&&t._handle.unref&&t._handle.unref();break;case"FILE":var s=require("fs");t=new s.SyncWriteStream(e,{autoClose:!1}),t._type="fs";break;case"PIPE":case"TCP":var i=require("net");t=new i.Socket({fd:e,readable:!1,writable:!0}),t.readable=!1,t.read=null,t._type="pipe",t._handle&&t._handle.unref&&t._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return t.fd=e,t._isStdio=!0,t}function ad(e){e.inspectOpts={};for(var t=Object.keys(x.inspectOpts),r=0;r<t.length;r++)e.inspectOpts[t[r]]=x.inspectOpts[t[r]]}x.enable(lo())});var po=f((em,Hs)=>{typeof process!="undefined"&&process.type==="renderer"?Hs.exports=uo():Hs.exports=fo()});var _o=f((tm,go)=>{var _t;go.exports=function(){if(!_t){try{_t=po()("follow-redirects")}catch(e){}typeof _t!="function"&&(_t=function(){})}_t.apply(null,arguments)}});var Co=f((rm,qs)=>{var fe=require("url"),Ps=fe.URL,ud=require("http"),cd=require("https"),mo=require("stream").Writable,ld=require("assert"),vo=_o(),pe=["abort","aborted","connect","error","socket","timeout"],Os=Object.create(null);pe.forEach(function(e){Os[e]=function(t,r,s){this._redirectable.emit(e,t,r,s)}});var yo=mr("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),hd=mr("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded"),dd=mr("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),fd=mr("ERR_STREAM_WRITE_AFTER_END","write after end");function I(e,t){mo.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var r=this;this._onNativeResponse=function(s){r._processResponse(s)},this._performRequest()}I.prototype=Object.create(mo.prototype);I.prototype.abort=function(){bo(this._currentRequest),this.emit("abort")};I.prototype.write=function(e,t,r){if(this._ending)throw new fd;if(!(typeof e=="string"||typeof e=="object"&&"length"in e))throw new TypeError("data should be a string, Buffer or Uint8Array");if(typeof t=="function"&&(r=t,t=null),e.length===0){r&&r();return}this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,r)):(this.emit("error",new dd),this.abort())};I.prototype.end=function(e,t,r){if(typeof e=="function"?(r=e,e=t=null):typeof t=="function"&&(r=t,t=null),!e)this._ended=this._ending=!0,this._currentRequest.end(null,null,r);else{var s=this,i=this._currentRequest;this.write(e,t,function(){s._ended=!0,i.end(null,null,r)}),this._ending=!0}};I.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)};I.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)};I.prototype.setTimeout=function(e,t){var r=this;function s(o){o.setTimeout(e),o.removeListener("timeout",o.destroy),o.addListener("timeout",o.destroy)}function i(o){r._timeout&&clearTimeout(r._timeout),r._timeout=setTimeout(function(){r.emit("timeout"),n()},e),s(o)}function n(){r._timeout&&(clearTimeout(r._timeout),r._timeout=null),r.removeListener("abort",n),r.removeListener("error",n),r.removeListener("response",n),t&&r.removeListener("timeout",t),r.socket||r._currentRequest.removeListener("socket",i)}return t&&this.on("timeout",t),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",s),this.on("abort",n),this.on("error",n),this.on("response",n),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(e){I.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}});["aborted","connection","socket"].forEach(function(e){Object.defineProperty(I.prototype,e,{get:function(){return this._currentRequest[e]}})});I.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}};I.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t){this.emit("error",new TypeError("Unsupported protocol "+e));return}if(this._options.agents){var r=e.substr(0,e.length-1);this._options.agent=this._options.agents[r]}var s=this._currentRequest=t.request(this._options,this._onNativeResponse);this._currentUrl=fe.format(this._options),s._redirectable=this;for(var i=0;i<pe.length;i++)s.on(pe[i],Os[pe[i]]);if(this._isRedirect){var n=0,o=this,a=this._requestBodyBuffers;(function u(c){if(s===o._currentRequest)if(c)o.emit("error",c);else if(n<a.length){var l=a[n++];s.finished||s.write(l.data,l.encoding,u)}else o._ended&&s.end()})()}};I.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var r=e.headers.location;if(r&&this._options.followRedirects!==!1&&t>=300&&t<400){if(bo(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects){this.emit("error",new hd);return}((t===301||t===302)&&this._options.method==="POST"||t===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],Ds(/^content-/i,this._options.headers));var s=Ds(/^host$/i,this._options.headers),i=fe.parse(this._currentUrl),n=s||i.host,o=/^\w+:/.test(r)?this._currentUrl:fe.format(Object.assign(i,{host:n})),a;try{a=fe.resolve(o,r)}catch(l){this.emit("error",new yo(l));return}vo("redirecting to",a),this._isRedirect=!0;var u=fe.parse(a);if(Object.assign(this._options,u),u.host===n||gd(u.host,n)||Ds(/^authorization$/i,this._options.headers),typeof this._options.beforeRedirect=="function"){var c={headers:e.headers};try{this._options.beforeRedirect.call(null,this._options,c)}catch(l){this.emit("error",l);return}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(l){this.emit("error",new yo(l))}}else e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),this._requestBodyBuffers=[]};function Ro(e){var t={maxRedirects:21,maxBodyLength:10*1024*1024},r={};return Object.keys(e).forEach(function(s){var i=s+":",n=r[i]=e[s],o=t[s]=Object.create(n);function a(c,l,h){if(typeof c=="string"){var d=c;try{c=Eo(new Ps(d))}catch(p){c=fe.parse(d)}}else Ps&&c instanceof Ps?c=Eo(c):(h=l,l=c,c={protocol:i});return typeof l=="function"&&(h=l,l=null),l=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},c,l),l.nativeProtocols=r,ld.equal(l.protocol,i,"protocol mismatch"),vo("options",l),new I(l,h)}function u(c,l,h){var d=o.request(c,l,h);return d.end(),d}Object.defineProperties(o,{request:{value:a,configurable:!0,enumerable:!0,writable:!0},get:{value:u,configurable:!0,enumerable:!0,writable:!0}})}),t}function pd(){}function Eo(e){var t={protocol:e.protocol,hostname:e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:e.pathname+e.search,href:e.href};return e.port!==""&&(t.port=Number(e.port)),t}function Ds(e,t){var r;for(var s in t)e.test(s)&&(r=t[s].toString().trim(),delete t[s]);return r}function mr(e,t){function r(s){Error.captureStackTrace(this,this.constructor),s?(this.message=t+": "+s.message,this.cause=s):this.message=t}return r.prototype=new Error,r.prototype.constructor=r,r.prototype.name="Error ["+e+"]",r.prototype.code=e,r}function bo(e){for(var t=0;t<pe.length;t++)e.removeListener(pe[t],Os[pe[t]]);e.on("error",pd),e.abort()}function gd(e,t){let r=e.length-t.length-1;return r>0&&e[r]==="."&&e.endsWith(t)}qs.exports=Ro({http:ud,https:cd});qs.exports.wrap=Ro});var To=f((sm,Ao)=>{var _d=require("http"),md=require("https"),mt=ro(),vr=gr(),vd=Co();mt=Object.keys(mt).map(function(e){return mt[e]});var yd={http:_d,https:md};Ao.exports={deleteLength:function(t,r,s){(t.method==="DELETE"||t.method==="OPTIONS")&&!t.headers["content-length"]&&(t.headers["content-length"]="0",delete t.headers["transfer-encoding"])},timeout:function(t,r,s){s.timeout&&t.socket.setTimeout(s.timeout)},XHeaders:function(t,r,s){if(!!s.xfwd){var i=t.isSpdy||vr.hasEncryptedConnection(t),n={for:t.connection.remoteAddress||t.socket.remoteAddress,port:vr.getPort(t),proto:i?"https":"http"};["for","port","proto"].forEach(function(o){t.headers["x-forwarded-"+o]=(t.headers["x-forwarded-"+o]||"")+(t.headers["x-forwarded-"+o]?",":"")+n[o]}),t.headers["x-forwarded-host"]=t.headers["x-forwarded-host"]||t.headers.host||""}},stream:function(t,r,s,i,n,o){n.emit("start",t,r,s.target||s.forward);var a=s.followRedirects?vd:yd,u=a.http,c=a.https;if(s.forward){var l=(s.forward.protocol==="https:"?c:u).request(vr.setupOutgoing(s.ssl||{},s,t,"forward")),h=g(l,s.forward);if(t.on("error",h),l.on("error",h),(s.buffer||t).pipe(l),!s.target)return r.end()}var d=(s.target.protocol==="https:"?c:u).request(vr.setupOutgoing(s.ssl||{},s,t));d.on("socket",function(y){n&&!d.getHeader("expect")&&n.emit("proxyReq",d,t,r,s)}),s.proxyTimeout&&d.setTimeout(s.proxyTimeout,function(){d.abort()}),t.on("aborted",function(){d.abort()});var p=g(d,s.target);t.on("error",p),d.on("error",p);function g(y,m){return function(k){if(t.socket.destroyed&&k.code==="ECONNRESET")return n.emit("econnreset",k,t,r,m),y.abort();o?o(k,t,r,m):n.emit("error",k,t,r,m)}}(s.buffer||t).pipe(d),d.on("response",function(y){if(n&&n.emit("proxyRes",y,t,r),!r.headersSent&&!s.selfHandleResponse)for(var m=0;m<mt.length&&!mt[m](t,r,y,s);m++);r.finished?n&&n.emit("end",t,r,y):(y.on("end",function(){n&&n.emit("end",t,r,y)}),s.selfHandleResponse||y.pipe(r))})}}});var So=f((nm,wo)=>{var Rd=require("http"),Ed=require("https"),qe=gr();wo.exports={checkMethodAndHeader:function(t,r){if(t.method!=="GET"||!t.headers.upgrade||t.headers.upgrade.toLowerCase()!=="websocket")return r.destroy(),!0},XHeaders:function(t,r,s){if(!!s.xfwd){var i={for:t.connection.remoteAddress||t.socket.remoteAddress,port:qe.getPort(t),proto:qe.hasEncryptedConnection(t)?"wss":"ws"};["for","port","proto"].forEach(function(n){t.headers["x-forwarded-"+n]=(t.headers["x-forwarded-"+n]||"")+(t.headers["x-forwarded-"+n]?",":"")+i[n]})}},stream:function(t,r,s,i,n,o){var a=function(l,h){return Object.keys(h).reduce(function(d,p){var g=h[p];if(!Array.isArray(g))return d.push(p+": "+g),d;for(var y=0;y<g.length;y++)d.push(p+": "+g[y]);return d},[l]).join(`\r
`)+`\r
\r
`};qe.setupSocket(r),i&&i.length&&r.unshift(i);var u=(qe.isSSL.test(s.target.protocol)?Ed:Rd).request(qe.setupOutgoing(s.ssl||{},s,t));return n&&n.emit("proxyReqWs",u,t,r,s,i),u.on("error",c),u.on("response",function(l){l.upgrade||(r.write(a("HTTP/"+l.httpVersion+" "+l.statusCode+" "+l.statusMessage,l.headers)),l.pipe(r))}),u.on("upgrade",function(l,h,d){h.on("error",c),h.on("end",function(){n.emit("close",l,h,d)}),r.on("error",function(){h.end()}),qe.setupSocket(h),d&&d.length&&h.unshift(d),r.write(a("HTTP/1.1 101 Switching Protocols",l.headers)),h.pipe(r).pipe(h),n.emit("open",h),n.emit("proxySocket",h)}),u.end();function c(l){o?o(l,t,r):n.emit("error",l,t,r),r.end()}}}});var Mo=f((im,qo)=>{var xo=qo.exports,Ho=require("util")._extend,bd=require("url").parse,Po=Ki(),Cd=require("http"),Ad=require("https"),Oo=To(),Do=So();xo.Server=ge;function Ms(e){return function(t){return function(r,s){var i=e==="ws"?this.wsPasses:this.webPasses,n=[].slice.call(arguments),o=n.length-1,a,u;typeof n[o]=="function"&&(u=n[o],o--);var c=t;if(!(n[o]instanceof Buffer)&&n[o]!==s&&(c=Ho({},t),Ho(c,n[o]),o--),n[o]instanceof Buffer&&(a=n[o]),["target","forward"].forEach(function(h){typeof c[h]=="string"&&(c[h]=bd(c[h]))}),!c.target&&!c.forward)return this.emit("error",new Error("Must provide a proper URL as target"));for(var l=0;l<i.length&&!i[l](r,s,c,a,this,u);l++);}}}xo.createRightProxy=Ms;function ge(e){Po.call(this),e=e||{},e.prependPath=e.prependPath!==!1,this.web=this.proxyRequest=Ms("web")(e),this.ws=this.proxyWebsocketRequest=Ms("ws")(e),this.options=e,this.webPasses=Object.keys(Oo).map(function(t){return Oo[t]}),this.wsPasses=Object.keys(Do).map(function(t){return Do[t]}),this.on("error",this.onError,this)}require("util").inherits(ge,Po);ge.prototype.onError=function(e){if(this.listeners("error").length===1)throw e};ge.prototype.listen=function(e,t){var r=this,s=function(i,n){r.web(i,n)};return this._server=this.options.ssl?Ad.createServer(this.options.ssl,s):Cd.createServer(s),this.options.ws&&this._server.on("upgrade",function(i,n,o){r.ws(i,n,o)}),this._server.listen(e,t),this};ge.prototype.close=function(e){var t=this;this._server&&this._server.close(r);function r(){t._server=null,e&&e.apply(null,arguments)}};ge.prototype.before=function(e,t,r){if(e!=="ws"&&e!=="web")throw new Error("type must be `web` or `ws`");var s=e==="ws"?this.wsPasses:this.webPasses,i=!1;if(s.forEach(function(n,o){n.name===t&&(i=o)}),i===!1)throw new Error("No such pass");s.splice(i,0,r)};ge.prototype.after=function(e,t,r){if(e!=="ws"&&e!=="web")throw new Error("type must be `web` or `ws`");var s=e==="ws"?this.wsPasses:this.webPasses,i=!1;if(s.forEach(function(n,o){n.name===t&&(i=o)}),i===!1)throw new Error("No such pass");s.splice(i++,0,r)}});var Lo=f((om,jo)=>{var vt=Mo().Server;function js(e){return new vt(e)}vt.createProxyServer=js;vt.createServer=js;vt.createProxy=js;jo.exports=vt});var Io=f((am,No)=>{No.exports=Lo()});var $o=f(yt=>{"use strict";var Td=yt&&yt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yt,"__esModule",{value:!0});var wd=Td(Io()),Sd=wd.default.createProxyServer({changeOrigin:!0});function xd(e,t,r,s){let n={target:{protocol:r.domainOrIp==="127.0.0.1"?"http":"https",host:r.domainOrIp,port:r.port}};Sd.web(e,t,n,s||Function.prototype)}yt.default=xd});var Ls=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var Hd=[/^x-0-/i,/^host$/i,/^x-request-id$/i,/^content-length$/i],Pd=[/^layer0_/i],Od=[/^layer0_devtools/i],Me=e=>{if(Hd.find(t=>e.match(t)))throw new Error(`Header "${e}" is reserved and cannot be modified`)},Dd=e=>{if(Pd.find(t=>e.match(t))&&!Od.find(t=>e.match(t)))throw new Error(`Cookie "${e}" is reserved and cannot be modified`)};Q.validateSetResponseHeader=e=>{Me(e)};Q.validateUpdateResponseHeader=e=>{Me(e)};Q.validateRemoveResponseHeader=e=>{Me(e)};Q.validateSetRequestHeader=e=>{Me(e)};Q.validateUpdateRequestHeader=e=>{Me(e)};Q.validateRemoveRequestHeader=e=>{Me(e)};Q.validateCookieName=e=>{Dd(e)}});var Is=f(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});function qd(e){return e==null?{}:typeof e=="string"?{path:e}:e}Ns.default=qd});var $s=f(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});var Md=lr(),yr=class extends Error{constructor(t){super(`Route pattern "${t}" contains invalid syntax. See https://docs.layer0.co/guides/routing#section_route_pattern_syntax`);this.isUserError=!0}};Rr.PathMatcherError=yr;var Rt=class{constructor(t){this.pattern=t}match(t){if(!this.matcher)try{this.matcher=Md.match(this.pattern,{decode:decodeURIComponent})}catch(s){throw new yr(this.pattern)}Rt.validatePattern(this.pattern);let r=this.matcher(t);return r?r.params:void 0}static validatePattern(t){let r=t.match(this.PARTIAL_SPLAT_ROUTE);if(r){let[s,i,n]=r,o=t.replace(`${i}${n}`,`${i}:suffix/${n}`);throw new yr(`Partial splat routes are not supported. Use "${o}" instead of "${t}"`)}return!0}};Rr.default=Rt;Rt.PARTIAL_SPLAT_ROUTE=/(\/[^:/]+)(:[^*/#?]+\*)/});var ko=f(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});function jd(e){return typeof e!="string"?"":e.toLowerCase()}ks.default=jd});var Cr=f(_e=>{"use strict";var Er=_e&&_e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Ld=_e&&_e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(_e,"__esModule",{value:!0});var Nd=S(),br=Je(),Id=fr(),$d=lr(),kd=Er(Is()),Uo=Ld($s()),Ud=Er(require("querystring")),Bd=Er(cr()),Fd=Er(ko()),je=class{constructor(t,r,s){this.criteria=kd.default(t),this.handler=r,this.options=s,this.criteria.path&&(this.matcher=new Uo.default(this.criteria.path))}match(t){let r=[this.matchPath,this.matchProtocol,this.matchMethod,this.matchHeaders,this.matchQueryParams,this.matchCookies],s={};for(let i of r){let n=i.bind(this)(t);if(!n)return!1;Object.assign(s,n)}return t.params=s,s}matchResponse(t){return this.matchResponseStatus(t)}matchResponseStatus(t){var r,s,i;return((s=(r=this.criteria)===null||r===void 0?void 0:r.response)===null||s===void 0?void 0:s.statusCode)?!!((i=t.statusCode)===null||i===void 0?void 0:i.toString().match(this.criteria.response.statusCode)):!1}matchPath(t){return this.matcher?this.matcher.match(t.path):{}}matchMethod(t){return!this.criteria.method||!t.method?!0:new RegExp(this.criteria.method,"i").test(t.method)}matchHeaders(t){return this.criteria.headers?br.matchCriteriaRegexObjectWithRequestObject(this.criteria.headers,t.headers,Fd.default):!0}matchQueryParams(t){return this.criteria.query?t.query?br.matchCriteriaRegexObjectWithRequestObject(this.criteria.query,t.query):!1:!0}matchCookies(t){if(this.criteria.cookies){let r=t.headers.cookie;if(r==null)return Object.values(this.criteria.cookies).every(n=>n===null);let s=Array.isArray(r)?r.join("; "):r,i=Id.parse(s);return br.matchCriteriaRegexObjectWithRequestObject(this.criteria.cookies,i)}return!0}matchProtocol(t){let r=t.headers&&t.headers[Nd.HTTP_HEADERS.x0Protocol]||"https",s;return typeof this.criteria.protocol=="string"?s=new RegExp(`^${this.criteria.protocol}$`,"i"):s=new RegExp(this.criteria.protocol||"^https$","i"),br.testRegExp(s,r)}toString(){let s=this.criteria,{path:t}=s,r=Hn(s,["path"]);return Object.keys(r).length?JSON.stringify(this.criteria):t||"fallback"}toRegex(){return je.toRegexp(this.criteria.path)}toJson(){var t;return JSON.stringify(w(b({},this.criteria),{label:(t=this.options)===null||t===void 0?void 0:t.label}),(r,s)=>s instanceof RegExp?s.toString():s)}toRegexString(){return this.toRegex().source}toEdgeRegexString(){return je.toEdgeRegexString(this.criteria.path)}isRespRoute(){return!!this.criteria.response}static toRegexp(t){if(t)try{return $d.pathToRegexp(t)}catch(r){throw new Uo.PathMatcherError(t)}else return/^.*$/}static toEdgeRegexString(t){return Bd.default(je.toRegexp(t))}static pathWithQueryString(t,r){let s=Ud.default.stringify(r).replace(/%3A/g,":");return t+(s&&`\\?${s}`)}};_e.default=je});var Bo=f(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});var Wd=require("zlib"),Us=S();function Gd(e){var t;((t=e.getHeader(Us.HTTP_HEADERS.contentEncoding))===null||t===void 0?void 0:t.toLowerCase())==="gzip"&&e.body instanceof Buffer&&(e.removeHeader(Us.HTTP_HEADERS.contentEncoding),e.removeHeader(Us.HTTP_HEADERS.contentLength),e.body=Wd.gunzipSync(e.body))}Bs.default=Gd});var Wo=f((gm,Fo)=>{"use strict";Fo.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}});var Vo=f((_m,Go)=>{"use strict";Go.exports=R;R.Node=me;R.create=R;function R(e){var t=this;if(t instanceof R||(t=new R),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(i){t.push(i)});else if(arguments.length>0)for(var r=0,s=arguments.length;r<s;r++)t.push(arguments[r]);return t}R.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t};R.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};R.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};R.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)Yd(this,arguments[e]);return this.length};R.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)Kd(this,arguments[e]);return this.length};R.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};R.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};R.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,s=0;r!==null;s++)e.call(t,r.value,s,this),r=r.next};R.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,s=this.length-1;r!==null;s--)e.call(t,r.value,s,this),r=r.prev};R.prototype.get=function(e){for(var t=0,r=this.head;r!==null&&t<e;t++)r=r.next;if(t===e&&r!==null)return r.value};R.prototype.getReverse=function(e){for(var t=0,r=this.tail;r!==null&&t<e;t++)r=r.prev;if(t===e&&r!==null)return r.value};R.prototype.map=function(e,t){t=t||this;for(var r=new R,s=this.head;s!==null;)r.push(e.call(t,s.value,this)),s=s.next;return r};R.prototype.mapReverse=function(e,t){t=t||this;for(var r=new R,s=this.tail;s!==null;)r.push(e.call(t,s.value,this)),s=s.prev;return r};R.prototype.reduce=function(e,t){var r,s=this.head;if(arguments.length>1)r=t;else if(this.head)s=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;s!==null;i++)r=e(r,s.value,i),s=s.next;return r};R.prototype.reduceReverse=function(e,t){var r,s=this.tail;if(arguments.length>1)r=t;else if(this.tail)s=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;s!==null;i--)r=e(r,s.value,i),s=s.prev;return r};R.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;r!==null;t++)e[t]=r.value,r=r.next;return e};R.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;r!==null;t++)e[t]=r.value,r=r.prev;return e};R.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new R;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=0,i=this.head;i!==null&&s<e;s++)i=i.next;for(;i!==null&&s<t;s++,i=i.next)r.push(i.value);return r};R.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new R;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=this.length,i=this.tail;i!==null&&s>t;s--)i=i.prev;for(;i!==null&&s>e;s--,i=i.prev)r.push(i.value);return r};R.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var s=0,i=this.head;i!==null&&s<e;s++)i=i.next;for(var n=[],s=0;i&&s<t;s++)n.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var s=0;s<r.length;s++)i=Vd(this,i,r[s]);return n};R.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;r!==null;r=r.prev){var s=r.prev;r.prev=r.next,r.next=s}return this.head=t,this.tail=e,this};function Vd(e,t,r){var s=t===e.head?new me(r,null,t,e):new me(r,t,t.next,e);return s.next===null&&(e.tail=s),s.prev===null&&(e.head=s),e.length++,s}function Yd(e,t){e.tail=new me(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function Kd(e,t){e.head=new me(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function me(e,t,r,s){if(!(this instanceof me))return new me(e,t,r,s);this.list=s,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{Wo()(R)}catch(e){}});var Zo=f((mm,Xo)=>{"use strict";var zd=Vo(),ve=Symbol("max"),J=Symbol("length"),Le=Symbol("lengthCalculator"),Et=Symbol("allowStale"),ye=Symbol("maxAge"),X=Symbol("dispose"),Yo=Symbol("noDisposeOnSet"),H=Symbol("lruList"),G=Symbol("cache"),Ko=Symbol("updateAgeOnGet"),Fs=()=>1,zo=class{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");let r=this[ve]=t.max||Infinity,s=t.length||Fs;if(this[Le]=typeof s!="function"?Fs:s,this[Et]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[ye]=t.maxAge||0,this[X]=t.dispose,this[Yo]=t.noDisposeOnSet||!1,this[Ko]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[ve]=t||Infinity,bt(this)}get max(){return this[ve]}set allowStale(t){this[Et]=!!t}get allowStale(){return this[Et]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[ye]=t,bt(this)}get maxAge(){return this[ye]}set lengthCalculator(t){typeof t!="function"&&(t=Fs),t!==this[Le]&&(this[Le]=t,this[J]=0,this[H].forEach(r=>{r.length=this[Le](r.value,r.key),this[J]+=r.length})),bt(this)}get lengthCalculator(){return this[Le]}get length(){return this[J]}get itemCount(){return this[H].length}rforEach(t,r){r=r||this;for(let s=this[H].tail;s!==null;){let i=s.prev;Jo(this,t,s,r),s=i}}forEach(t,r){r=r||this;for(let s=this[H].head;s!==null;){let i=s.next;Jo(this,t,s,r),s=i}}keys(){return this[H].toArray().map(t=>t.key)}values(){return this[H].toArray().map(t=>t.value)}reset(){this[X]&&this[H]&&this[H].length&&this[H].forEach(t=>this[X](t.key,t.value)),this[G]=new Map,this[H]=new zd,this[J]=0}dump(){return this[H].map(t=>Ar(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[H]}set(t,r,s){if(s=s||this[ye],s&&typeof s!="number")throw new TypeError("maxAge must be a number");let i=s?Date.now():0,n=this[Le](r,t);if(this[G].has(t)){if(n>this[ve])return Ne(this,this[G].get(t)),!1;let u=this[G].get(t).value;return this[X]&&(this[Yo]||this[X](t,u.value)),u.now=i,u.maxAge=s,u.value=r,this[J]+=n-u.length,u.length=n,this.get(t),bt(this),!0}let o=new Qo(t,r,n,i,s);return o.length>this[ve]?(this[X]&&this[X](t,r),!1):(this[J]+=o.length,this[H].unshift(o),this[G].set(t,this[H].head),bt(this),!0)}has(t){if(!this[G].has(t))return!1;let r=this[G].get(t).value;return!Ar(this,r)}get(t){return Ws(this,t,!0)}peek(t){return Ws(this,t,!1)}pop(){let t=this[H].tail;return t?(Ne(this,t),t.value):null}del(t){Ne(this,this[G].get(t))}load(t){this.reset();let r=Date.now();for(let s=t.length-1;s>=0;s--){let i=t[s],n=i.e||0;if(n===0)this.set(i.k,i.v);else{let o=n-r;o>0&&this.set(i.k,i.v,o)}}}prune(){this[G].forEach((t,r)=>Ws(this,r,!1))}},Ws=(e,t,r)=>{let s=e[G].get(t);if(s){let i=s.value;if(Ar(e,i)){if(Ne(e,s),!e[Et])return}else r&&(e[Ko]&&(s.value.now=Date.now()),e[H].unshiftNode(s));return i.value}},Ar=(e,t)=>{if(!t||!t.maxAge&&!e[ye])return!1;let r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[ye]&&r>e[ye]},bt=e=>{if(e[J]>e[ve])for(let t=e[H].tail;e[J]>e[ve]&&t!==null;){let r=t.prev;Ne(e,t),t=r}},Ne=(e,t)=>{if(t){let r=t.value;e[X]&&e[X](r.key,r.value),e[J]-=r.length,e[G].delete(r.key),e[H].removeNode(t)}},Qo=class{constructor(t,r,s,i,n){this.key=t,this.value=r,this.length=s,this.now=i,this.maxAge=n||0}},Jo=(e,t,r,s)=>{let i=r.value;Ar(e,i)&&(Ne(e,r),e[Et]||(i=void 0)),i&&t.call(s,i.value,i.key,e)};Xo.exports=zo});var on=f((Tt,Ue)=>{var Qd=200,ea="__lodash_hash_undefined__",ta=9007199254740991,Gs="[object Arguments]",Jd="[object Array]",ra="[object Boolean]",sa="[object Date]",Xd="[object Error]",Vs="[object Function]",na="[object GeneratorFunction]",Tr="[object Map]",ia="[object Number]",Ys="[object Object]",oa="[object Promise]",aa="[object RegExp]",wr="[object Set]",ua="[object String]",ca="[object Symbol]",Ks="[object WeakMap]",la="[object ArrayBuffer]",Sr="[object DataView]",ha="[object Float32Array]",da="[object Float64Array]",fa="[object Int8Array]",pa="[object Int16Array]",ga="[object Int32Array]",_a="[object Uint8Array]",ma="[object Uint8ClampedArray]",va="[object Uint16Array]",ya="[object Uint32Array]",Zd=/[\\^$.*+?()[\]{}|]/g,ef=/\w*$/,tf=/^\[object .+?Constructor\]$/,rf=/^(?:0|[1-9]\d*)$/,A={};A[Gs]=A[Jd]=A[la]=A[Sr]=A[ra]=A[sa]=A[ha]=A[da]=A[fa]=A[pa]=A[ga]=A[Tr]=A[ia]=A[Ys]=A[aa]=A[wr]=A[ua]=A[ca]=A[_a]=A[ma]=A[va]=A[ya]=!0;A[Xd]=A[Vs]=A[Ks]=!1;var sf=typeof global=="object"&&global&&global.Object===Object&&global,nf=typeof self=="object"&&self&&self.Object===Object&&self,Z=sf||nf||Function("return this")(),Ra=typeof Tt=="object"&&Tt&&!Tt.nodeType&&Tt,Ea=Ra&&typeof Ue=="object"&&Ue&&!Ue.nodeType&&Ue,of=Ea&&Ea.exports===Ra;function af(e,t){return e.set(t[0],t[1]),e}function uf(e,t){return e.add(t),e}function cf(e,t){for(var r=-1,s=e?e.length:0;++r<s&&t(e[r],r,e)!==!1;);return e}function lf(e,t){for(var r=-1,s=t.length,i=e.length;++r<s;)e[i+r]=t[r];return e}function ba(e,t,r,s){var i=-1,n=e?e.length:0;for(s&&n&&(r=e[++i]);++i<n;)r=t(r,e[i],i,e);return r}function hf(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}function df(e,t){return e==null?void 0:e[t]}function Ca(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch(r){}return t}function Aa(e){var t=-1,r=Array(e.size);return e.forEach(function(s,i){r[++t]=[i,s]}),r}function zs(e,t){return function(r){return e(t(r))}}function Ta(e){var t=-1,r=Array(e.size);return e.forEach(function(s){r[++t]=s}),r}var ff=Array.prototype,pf=Function.prototype,xr=Object.prototype,Qs=Z["__core-js_shared__"],wa=function(){var e=/[^.]+$/.exec(Qs&&Qs.keys&&Qs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Sa=pf.toString,ie=xr.hasOwnProperty,Hr=xr.toString,gf=RegExp("^"+Sa.call(ie).replace(Zd,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xa=of?Z.Buffer:void 0,Ha=Z.Symbol,Pa=Z.Uint8Array,_f=zs(Object.getPrototypeOf,Object),mf=Object.create,vf=xr.propertyIsEnumerable,yf=ff.splice,Oa=Object.getOwnPropertySymbols,Rf=xa?xa.isBuffer:void 0,Ef=zs(Object.keys,Object),Js=ke(Z,"DataView"),Ct=ke(Z,"Map"),Xs=ke(Z,"Promise"),Zs=ke(Z,"Set"),en=ke(Z,"WeakMap"),At=ke(Object,"create"),bf=be(Js),Cf=be(Ct),Af=be(Xs),Tf=be(Zs),wf=be(en),Da=Ha?Ha.prototype:void 0,qa=Da?Da.valueOf:void 0;function Re(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function Sf(){this.__data__=At?At(null):{}}function xf(e){return this.has(e)&&delete this.__data__[e]}function Hf(e){var t=this.__data__;if(At){var r=t[e];return r===ea?void 0:r}return ie.call(t,e)?t[e]:void 0}function Pf(e){var t=this.__data__;return At?t[e]!==void 0:ie.call(t,e)}function Of(e,t){var r=this.__data__;return r[e]=At&&t===void 0?ea:t,this}Re.prototype.clear=Sf;Re.prototype.delete=xf;Re.prototype.get=Hf;Re.prototype.has=Pf;Re.prototype.set=Of;function ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function Df(){this.__data__=[]}function qf(e){var t=this.__data__,r=Pr(t,e);if(r<0)return!1;var s=t.length-1;return r==s?t.pop():yf.call(t,r,1),!0}function Mf(e){var t=this.__data__,r=Pr(t,e);return r<0?void 0:t[r][1]}function jf(e){return Pr(this.__data__,e)>-1}function Lf(e,t){var r=this.__data__,s=Pr(r,e);return s<0?r.push([e,t]):r[s][1]=t,this}ee.prototype.clear=Df;ee.prototype.delete=qf;ee.prototype.get=Mf;ee.prototype.has=jf;ee.prototype.set=Lf;function Ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function Nf(){this.__data__={hash:new Re,map:new(Ct||ee),string:new Re}}function If(e){return Or(this,e).delete(e)}function $f(e){return Or(this,e).get(e)}function kf(e){return Or(this,e).has(e)}function Uf(e,t){return Or(this,e).set(e,t),this}Ie.prototype.clear=Nf;Ie.prototype.delete=If;Ie.prototype.get=$f;Ie.prototype.has=kf;Ie.prototype.set=Uf;function $e(e){this.__data__=new ee(e)}function Bf(){this.__data__=new ee}function Ff(e){return this.__data__.delete(e)}function Wf(e){return this.__data__.get(e)}function Gf(e){return this.__data__.has(e)}function Vf(e,t){var r=this.__data__;if(r instanceof ee){var s=r.__data__;if(!Ct||s.length<Qd-1)return s.push([e,t]),this;r=this.__data__=new Ie(s)}return r.set(e,t),this}$e.prototype.clear=Bf;$e.prototype.delete=Ff;$e.prototype.get=Wf;$e.prototype.has=Gf;$e.prototype.set=Vf;function Yf(e,t){var r=sn(e)||mp(e)?hf(e.length,String):[],s=r.length,i=!!s;for(var n in e)(t||ie.call(e,n))&&!(i&&(n=="length"||fp(n,s)))&&r.push(n);return r}function Ma(e,t,r){var s=e[t];(!(ie.call(e,t)&&Ia(s,r))||r===void 0&&!(t in e))&&(e[t]=r)}function Pr(e,t){for(var r=e.length;r--;)if(Ia(e[r][0],t))return r;return-1}function Kf(e,t){return e&&ja(t,nn(t),e)}function tn(e,t,r,s,i,n,o){var a;if(s&&(a=n?s(e,i,n,o):s(e)),a!==void 0)return a;if(!Dr(e))return e;var u=sn(e);if(u){if(a=lp(e),!t)return ap(e,a)}else{var c=Ee(e),l=c==Vs||c==na;if(yp(e))return ep(e,t);if(c==Ys||c==Gs||l&&!n){if(Ca(e))return n?e:{};if(a=hp(l?{}:e),!t)return up(e,Kf(a,e))}else{if(!A[c])return n?e:{};a=dp(e,c,tn,t)}}o||(o=new $e);var h=o.get(e);if(h)return h;if(o.set(e,a),!u)var d=r?cp(e):nn(e);return cf(d||e,function(p,g){d&&(g=p,p=e[g]),Ma(a,g,tn(p,t,r,s,g,e,o))}),a}function zf(e){return Dr(e)?mf(e):{}}function Qf(e,t,r){var s=t(e);return sn(e)?s:lf(s,r(e))}function Jf(e){return Hr.call(e)}function Xf(e){if(!Dr(e)||gp(e))return!1;var t=ka(e)||Ca(e)?gf:tf;return t.test(be(e))}function Zf(e){if(!Na(e))return Ef(e);var t=[];for(var r in Object(e))ie.call(e,r)&&r!="constructor"&&t.push(r);return t}function ep(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}function rn(e){var t=new e.constructor(e.byteLength);return new Pa(t).set(new Pa(e)),t}function tp(e,t){var r=t?rn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}function rp(e,t,r){var s=t?r(Aa(e),!0):Aa(e);return ba(s,af,new e.constructor)}function sp(e){var t=new e.constructor(e.source,ef.exec(e));return t.lastIndex=e.lastIndex,t}function np(e,t,r){var s=t?r(Ta(e),!0):Ta(e);return ba(s,uf,new e.constructor)}function ip(e){return qa?Object(qa.call(e)):{}}function op(e,t){var r=t?rn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function ap(e,t){var r=-1,s=e.length;for(t||(t=Array(s));++r<s;)t[r]=e[r];return t}function ja(e,t,r,s){r||(r={});for(var i=-1,n=t.length;++i<n;){var o=t[i],a=s?s(r[o],e[o],o,r,e):void 0;Ma(r,o,a===void 0?e[o]:a)}return r}function up(e,t){return ja(e,La(e),t)}function cp(e){return Qf(e,nn,La)}function Or(e,t){var r=e.__data__;return pp(t)?r[typeof t=="string"?"string":"hash"]:r.map}function ke(e,t){var r=df(e,t);return Xf(r)?r:void 0}var La=Oa?zs(Oa,Object):bp,Ee=Jf;(Js&&Ee(new Js(new ArrayBuffer(1)))!=Sr||Ct&&Ee(new Ct)!=Tr||Xs&&Ee(Xs.resolve())!=oa||Zs&&Ee(new Zs)!=wr||en&&Ee(new en)!=Ks)&&(Ee=function(e){var t=Hr.call(e),r=t==Ys?e.constructor:void 0,s=r?be(r):void 0;if(s)switch(s){case bf:return Sr;case Cf:return Tr;case Af:return oa;case Tf:return wr;case wf:return Ks}return t});function lp(e){var t=e.length,r=e.constructor(t);return t&&typeof e[0]=="string"&&ie.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function hp(e){return typeof e.constructor=="function"&&!Na(e)?zf(_f(e)):{}}function dp(e,t,r,s){var i=e.constructor;switch(t){case la:return rn(e);case ra:case sa:return new i(+e);case Sr:return tp(e,s);case ha:case da:case fa:case pa:case ga:case _a:case ma:case va:case ya:return op(e,s);case Tr:return rp(e,s,r);case ia:case ua:return new i(e);case aa:return sp(e);case wr:return np(e,s,r);case ca:return ip(e)}}function fp(e,t){return t=t??ta,!!t&&(typeof e=="number"||rf.test(e))&&e>-1&&e%1==0&&e<t}function pp(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function gp(e){return!!wa&&wa in e}function Na(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||xr;return e===r}function be(e){if(e!=null){try{return Sa.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function _p(e){return tn(e,!0,!0)}function Ia(e,t){return e===t||e!==e&&t!==t}function mp(e){return vp(e)&&ie.call(e,"callee")&&(!vf.call(e,"callee")||Hr.call(e)==Gs)}var sn=Array.isArray;function $a(e){return e!=null&&Rp(e.length)&&!ka(e)}function vp(e){return Ep(e)&&$a(e)}var yp=Rf||Cp;function ka(e){var t=Dr(e)?Hr.call(e):"";return t==Vs||t==na}function Rp(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ta}function Dr(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Ep(e){return!!e&&typeof e=="object"}function nn(e){return $a(e)?Yf(e):Zf(e)}function bp(){return[]}function Cp(){return!1}Ue.exports=_p});var un=f(te=>{"use strict";var Ua=te&&te.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(te,"__esModule",{value:!0});var P=S(),Ap=Ua(Zo()),Tp=Ua(on()),an;function wp(){return process.env.LAYER0_CACHE==="true"}te.isCacheEnabled=wp;function qr(){return an||(an=new Ap.default),an}te.getCache=qr;function Sp(){qr().reset()}te.clearCache=Sp;function xp(e){return qr().get(e.toString())}te.getCachedResponse=xp;function Hp({response:e,cacheKey:t,context:r}){var s;let i=(s=t.method)===null||s===void 0?void 0:s.toLowerCase();if(i&&!P.CACHEABLE_METHODS.has(i)&&r.cacheRouteMethod!==i)return e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.method),!1;if(t.body&&Buffer.from(t.body,"utf8").length>8e3)return e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.bodyTooBig),!1;if(e.statusCode&&e.statusCode>=400)return e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.code),!1;if(e.getHeader(P.HTTP_HEADERS.setCookie))return e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.setCookie),!1;let n=Op(e);return n.private&&!r.forcePrivateCaching?(e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.private),!1):n.maxAge?(qr().set(t.toString(),Pp(e),n.maxAge*1e3),e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.ok),!0):(e.setHeader(P.HTTP_HEADERS.x0CachingStatus,P.CACHING_STATUS.noMaxAge),!1)}te.maybeCacheResponse=Hp;function Pp(e){return{statusCode:e.statusCode,statusMessage:e.statusMessage,headers:Tp.default(e.getHeaders()),body:e.body}}function Op(e){return b(b(b({},{private:!1,maxAge:0}),Ba(e.getHeader(P.HTTP_HEADERS.cacheControl))),Ba(e.getHeader(P.HTTP_HEADERS.x0CacheControl)))}function Ba(e){let t={};if(e){Array.isArray(e)||(e=[e]);let r={};for(let s of e){let i=s.split(/,\s*/).map(n=>n.split(/=/));for(let[n,o]of i)n&&o&&(r[n.toLowerCase()]=o),n.toLowerCase()==="private"&&(t.private=!0);t.maxAge=parseInt(r["s-maxage"]||r["max-age"]||"0")}}return t}});var Fa=f(wt=>{"use strict";var Dp=wt&&wt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(wt,"__esModule",{value:!0});var oe=S(),qp=Dp(require("crypto")),Mr=class{constructor(t,r){var s;this.cookies={};let{host:i}=t.headers;if(this.body=t.body,this.method=(s=t.method)===null||s===void 0?void 0:s.toLowerCase(),this.query=this.excludeLayer0QueryParams(t.query||{}),this.pathname=new URL(t.url,`http://${i}`).pathname,this.headers=this.getDefaultHeaders(t.headers),r)for(let n of r.getActions())n(this,t)}static create(t,r){return new Mr(t,r)}excludeLayer0QueryParams(t){let r={};for(let s in t)s.startsWith("layer0_")||(r[s]=t[s]);return r}toSortedArray(t){return Object.keys(t).sort().map(r=>[r,t[r]])}getDefaultHeaders(t){return{[oe.HTTP_HEADERS.host]:t[oe.HTTP_HEADERS.host],[oe.HTTP_HEADERS.acceptEncoding]:t[oe.HTTP_HEADERS.acceptEncoding],[oe.HTTP_HEADERS.x0Destination]:t[oe.HTTP_HEADERS.x0Destination],[oe.HTTP_HEADERS.x0Protocol]:t[oe.HTTP_HEADERS.x0Protocol]}}toString(){return JSON.stringify({pathname:this.pathname,method:this.method,query:this.toSortedArray(this.query),body:Mp(this.body),headers:this.toSortedArray(this.headers),cookies:this.toSortedArray(this.cookies)})}};wt.default=Mr;function Mp(e){if(!e)return null;let t=qp.default.createHash("sha256");return t.update(e),t.digest("hex")}});var Wa=f(ae=>{"use strict";var jp=ae&&ae.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ae,"__esModule",{value:!0});var Lp=jp(ue()),cn,St,ln="info",hn="warn",dn="error";try{let e=Lp.default("chalk"),t=e.hex("D355A7");St=e.grey("Layer0"),cn=e.bold(`Layer${t("0")}`),ln=e.cyan(ln),hn=e.yellow(hn),dn=e.red(dn)}catch(e){cn=St="Layer0"}ae.infoLogLabel=`${St} ${ln} -`;ae.warnLogLabel=`${St} ${hn} -`;ae.errorLogLabel=`${St} ${dn} -`;ae.default=cn});var Nr=f(Ht=>{"use strict";var $=Ht&&Ht.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ht,"__esModule",{value:!0});var jr=$(require("fs")),Np=require("path"),Be=$(ds()),Lr=$(de()),Ip=$(Fi()),$p=$(Cs()),kp=$($o()),T=S(),Up=Ye(),U=Ls(),Bp=$(Cr()),Fp=$(Bo()),xt=un(),Wp=$(Fa()),M=zr(),Gp=$($s()),Vp=$(ue()),Ce=Wa(),Yp=ss(),Ga=$(on()),Kp=$(Rs()),Va=class extends Yp.BaseResponseWriter{constructor(t,r,s,i){super(t,r,s);this.params={},this.streaming=!1,this.preCacheRequestActions=[],this.postCacheRequestActions=[],this.preCacheResponseActions=[],this.postCacheResponseActions=[],this.interpolateParams=n=>$p.default(this.request,this.response,n),this.redirect=(n,o={})=>{let{to:a,statusCode:u,query:c}=this._readRedirectParams(n,o),l=Kp.default(this.request.url,Be.default(Bp.default.pathWithQueryString(a,c),this.request.params));this.setResponseHeader(T.HTTP_HEADERS.location,l),this.send("",u)},this.proxy=async(n,o)=>{let a=Lr.default.get(`backends.${n}`);await this.proxyHost(a,o)},this.render=n=>{console.warn(`${Ce.warnLogLabel} Warning ResponseWriter#render is deprecated.`),n(this.request,this.proxy,this.request.params)},this.renderWithApp=n=>this.proxy(T.BACKENDS.js,n),this.stream=n=>{if(process.env.NODE_ENV==="production")throw new Error("stream can only be used in development");let o=Ya(Lr.default.get(`backends.${n}`));this.response.setHeader(T.HTTP_HEADERS.contentType,"text/event-stream"),this.streaming=!0,kp.default(this.request,this.response,o,Function.prototype),this.setCreateResponseAction(()=>Promise.resolve())},this.proxyHost=async(n,{path:o,transformRequest:a,transformResponse:u,headers:c}={})=>{n=Ya(n);let l=new Ip.default(n),h;typeof o=="function"?h=o():h=o,h=h&&Be.default(h,this.request.params),await this.setCreateResponseAction(async()=>{try{if(a){let p=new M.InternalTiming(M.InternalNames.transformRequest).start();try{await this.runImmediately(()=>a(this.request))}finally{p.end()}}let d=new M.InternalTiming(M.InternalNames.proxying).start();try{await l.fetch(this.request,this.response,{path:h||this.request.url,disableCheckCert:n.disableCheckCert,headers:c})}finally{d.end()}if(u){let p=new M.InternalTiming(M.InternalNames.transformResponse).start();try{Fp.default(this.response),await this.runImmediately(()=>u(this.response,this.request))}finally{p.end()}}}catch(d){d.type==="BackendFetchError"?(console.error(`${Ce.errorLogLabel} Could not connect to backend ${n.domainOrIp}:`,d.message),this.response.statusCode=503):(console.error(`${Ce.errorLogLabel} Error in ResponseWriter:`,d),this.response.statusCode=500)}})},this.updatePath=n=>{let o=Be.default(n,this.request.params);Object.defineProperty(this.request,"path",{get:()=>o})},this.rewrite=(n,o)=>{let a=Be.default(n,this.request.params);this.request.params=new Gp.default(o).match(a)},this.serveStatic=async(n,o={})=>{let a=n&&Be.default(n,this.request.params),{permanent:u,exclude:c}=o;if(a=a.replace(/\/$/,""),c==null?void 0:c.some(l=>a.indexOf(l)>=0))return this.send("404 - Not found",404);if(Up.isCloud()){let l=Lr.default.get(`backends.${u?T.BACKENDS.permanentStatic:T.BACKENDS.static}`);await this.proxyHost(l,{path:a,transformResponse:async h=>{h.statusCode===403&&(o.loadingPage?await this.proxyHost(Lr.default.get(`backends.${T.BACKENDS.static}`),{path:Be.default(o.loadingPage,this.request.params)}):o.onNotFound?await o.onNotFound(this):(h.statusCode=404,h.statusMessage="Not Found")),o.statusCode&&(h.statusCode=o.statusCode),o.statusMessage&&(h.statusMessage=o.statusMessage)}})}else{if(!jr.default.existsSync(a))return this.send("404 - Not found",404);jr.default.lstatSync(a).isDirectory()&&(a=Np.join(a,"./index.html"));let l=jr.default.statSync(a),d=Vp.default("mime-types").lookup(a);d&&this.setResponseHeader(T.HTTP_HEADERS.contentType,d),this.internalSetResponseHeader(T.HTTP_HEADERS.contentLength,l.size.toString(),!1,this.postCacheResponseActions),o.statusCode&&(this.response.statusCode=o.statusCode,this.response.statusMessage=o.statusMessage),this.setCreateResponseAction(()=>new Promise((p,g)=>{jr.default.readFile(a,(y,m)=>{y?g(y):(this.response.body=m,p())})}))}},this.cache=n=>{let{browser:o,edge:a,key:u}=n;if(a){let{maxAgeSeconds:c,staleWhileRevalidateSeconds:l,forcePrivateCaching:h}=a,d=[];typeof h!="undefined"&&(this.context.forcePrivateCaching=h===!0),this.cacheKey=u,typeof this.route.criteria.method=="string"&&(this.context.cacheRouteMethod=this.route.criteria.method),c&&(d.push("max-age="+c),l&&d.push("stale-while-revalidate="+l)),d.length&&this.internalSetResponseHeader(T.HTTP_HEADERS.x0CacheControl,d.join(", "),!1,this.preCacheResponseActions)}if(o||o===!1){let{maxAgeSeconds:c,serviceWorkerSeconds:l}=o||{maxAgeSeconds:0};c===0?this.setResponseHeader(T.HTTP_HEADERS.cacheControl,"private, no-store, no-cache"):c&&this.setResponseHeader(T.HTTP_HEADERS.cacheControl,`private, max-age=${c}`),l&&this.setResponseHeader(T.HTTP_HEADERS.xSwCacheControl,`max-age=${l}`)}},this.setResponseHeader=(n,o)=>{this.internalSetResponseHeader(n,o,!0,this.postCacheResponseActions)},this.internalSetResponseHeader=(n,o,a,u)=>{a&&U.validateSetResponseHeader(n),this.scheduleExecution(u,()=>{let c=this.interpolateParams(o);this.response.setHeader(n,c)})},this.updateResponseHeader=(n,o,a)=>{this.internalUpdateResponseHeader(n,o,a,this.preCacheResponseActions)},this.internalUpdateResponseHeader=(n,o,a,u)=>{U.validateUpdateResponseHeader(n),this.scheduleExecution(u,()=>{let c=this.response.getHeader(n),l=this.interpolateParams(a);c&&this.response.setHeader(n,c.replace(o,l))})},this.removeResponseHeader=n=>{this.internalRemoveResponseHeader(n,this.postCacheResponseActions)},this.internalRemoveResponseHeader=(n,o)=>{U.validateRemoveResponseHeader(n),this.scheduleExecution(o,()=>{this.response.removeHeader(n)})},this.getSetCookieValues=()=>{let n=this.response.getHeader(T.HTTP_HEADERS.setCookie);return typeof n=="string"?[n]:n||[]},this.getAddResponseCookieAction=(n,o,a={})=>()=>{let u=this.getSetCookieValues(),c=this.interpolateParams(o),l=`${n}=${c}`,h;for(h in a){let d=a[h];typeof d=="boolean"&&d?l+=`; ${h}`:l+=`; ${h}=${d}`}this.response.setHeader(T.HTTP_HEADERS.setCookie,[...u,l])},this.addUpstreamResponseCookie=(n,o,a)=>{U.validateCookieName(n),this.scheduleExecution(this.preCacheResponseActions,this.getAddResponseCookieAction(n,o,a))},this.addResponseCookie=(n,o,a)=>{U.validateCookieName(n),this.scheduleExecution(this.postCacheResponseActions,this.getAddResponseCookieAction(n,o,a))},this.getUpdateResponseCookieAction=(n,o,a)=>()=>{let u=this.getSetCookieValues().map(c=>{let[l,...h]=c.split("=");if(l!==n)return c;let d=h.join("=").replace(o,a);return[l,d].join("=")});this.response.setHeader(T.HTTP_HEADERS.setCookie,u)},this.updateUpstreamResponseCookie=(n,o,a)=>{U.validateCookieName(n),this.scheduleExecution(this.preCacheResponseActions,this.getUpdateResponseCookieAction(n,o,a))},this.updateResponseCookie=(n,o,a)=>{U.validateCookieName(n),this.scheduleExecution(this.postCacheResponseActions,this.getUpdateResponseCookieAction(n,o,a))},this.getRemoveResponseCookieAction=n=>()=>{let o=this.getSetCookieValues().filter(a=>a.split("=")[0]!==n);this.response.setHeader(T.HTTP_HEADERS.setCookie,o)},this.removeUpstreamResponseCookie=n=>{U.validateCookieName(n),this.scheduleExecution(this.preCacheResponseActions,this.getRemoveResponseCookieAction(n))},this.removeResponseCookie=n=>{U.validateCookieName(n),this.scheduleExecution(this.postCacheResponseActions,this.getRemoveResponseCookieAction(n))},this.setUpstreamResponseHeader=(n,o)=>{let a=n.toLowerCase()!=T.HTTP_HEADERS.x0SurrogateKey;return this.internalSetResponseHeader(n,o,a,this.preCacheResponseActions)},this.updateUpstreamResponseHeader=(n,o,a)=>this.internalUpdateResponseHeader(n,o,a,this.preCacheResponseActions),this.removeUpstreamResponseHeader=n=>this.internalRemoveResponseHeader(n,this.preCacheResponseActions),this.setRequestHeader=(n,o)=>{U.validateSetRequestHeader(n),this.scheduleExecution(this.postCacheRequestActions,()=>{this.request.headers[n.toLowerCase()]=o})},this.runImmediatelyDepthCounter=0,this.runImmediately=async n=>{try{++this.runImmediatelyDepthCounter,await n()}finally{--this.runImmediatelyDepthCounter}},this.scheduleExecution=(n,o)=>{this.runningImmediately?o():n.push(o)},this.updateRequestHeader=(n,o,a)=>{U.validateUpdateRequestHeader(n),this.scheduleExecution(this.postCacheRequestActions,()=>{let u=n.toLowerCase(),c=this.request.headers[u],l=this.interpolateParams(a);Array.isArray(c)?this.request.headers[u]=c.map(h=>h.replace(o,l)):c&&(this.request.headers[u]=c.replace(o,l))})},this.removeRequestHeader=n=>{U.validateRemoveRequestHeader(n),this.scheduleExecution(this.postCacheRequestActions,()=>{delete this.request.headers[n.toLowerCase()]})},this.serviceWorker=n=>{this.cache({edge:{maxAgeSeconds:30758400},browser:{maxAgeSeconds:0}}),this.serveStatic(n)},this.appShell=n=>{this.setResponseHeader(T.HTTP_HEADERS.contentType,"text/html"),this.serveStatic(n)},this.allowCors=(n={})=>{this.setResponseHeader("Access-Control-Allow-Origin",n.origin||"*"),n.methods&&this.setResponseHeader("Access-Control-Allow-Methods",n.methods.join(", ")),n.headers&&this.setResponseHeader("Access-Control-Allow-Headers",n.headers.join(", ")),n.maxAge&&this.setResponseHeader("Access-Control-Max-Age",n.maxAge.toString()),n.credentials!=null&&this.setResponseHeader("Access-Control-Allow-Credentials",n.credentials.toString())},this.send=(n,o=200,a)=>{this.setCreateResponseAction(async()=>{this.response.statusCode=o,this.response.statusMessage=a,typeof n=="function"?this.response.body=n():this.response.body=n})},this.compute=n=>{this.setCreateResponseAction(async()=>{await this.clearResponseAction().runImmediately(()=>n(this.request,this.response))})},this.onRouteError=n=>{let o={status:"error",message:n.message},a=n.isUserError;a&&console.error(`${Ce.errorLogLabel} ${n.message}`),process.env.NODE_ENV!=="production"&&(o={message:`An error occured while running route ${this.route.toString()}: ${n.message}`,stack:a?void 0:n.stack,url:this.request.url});try{this.response.setHeader(T.HTTP_HEADERS.contentType,"application/json"),this.response.writeHead(500),this.response.end(JSON.stringify(o))}catch(u){console.error(`${Ce.errorLogLabel} Could not write error response because headers have already been sent.`,o)}},this.request=t,this.response=r,this.route=s,this.context=i}async sendResponse({beforeResponse:t=()=>!0}={}){let r=!1;for(let n of this.preCacheRequestActions)n();let s,i;if(xt.isCacheEnabled()&&(i=this.context.cacheKey||Wp.default.create(this.request,this.cacheKey),s=xt.getCachedResponse(i),this.cacheKey&&(this.context.cacheKey=i),!this.validatePrefetch(s)))return console.log(`${Ce.infoLogLabel} throttle ${this.request.url}`),!0;if(s)r=!0,new M.InternalTiming(M.InternalNames.edgeCache).set(M.CacheValue.hit),this.applyCachedResponse(s);else{for(let o of this.postCacheRequestActions)o();this.createResponseAction&&(await this.createResponseAction(),r=!0);for(let o of this.preCacheResponseActions)o();if(!await t(this.response))return r}if(r&&!this.streaming&&!s&&xt.isCacheEnabled()){let n=xt.maybeCacheResponse({response:this.response,cacheKey:i,context:this.context});new M.InternalTiming(M.InternalNames.edgeCache).set(n?M.CacheValue.cached:M.CacheValue.pass)}for(let n of this.postCacheResponseActions)n();return r&&!this.streaming&&(this.logCacheStatus(),M.addTimings(this.response),this.response.statusCode&&this.response.writeHead(this.response.statusCode,this.response.statusMessage||void 0),this.response.end(this.response.body)),r}logCacheStatus(){if(xt.isCacheEnabled()){let t=this.response.getHeader(T.HTTP_HEADERS.x0CachingStatus),r=M.getInternalTiming(M.InternalNames.edgeCache),{url:s}=this.request;console.log(`${Ce.infoLogLabel} ${r} ${s}${t?` (${t})`:""}`)}}applyCachedResponse(t){this.response.statusCode=t.statusCode,this.response.statusMessage=t.statusMessage,this.response.body=Ga.default(t.body);for(let r of Object.keys(t.headers))this.response.setHeader(r,Ga.default(t.headers[r]))}validatePrefetch(t){return Object.keys(this.request.query||{}).includes(T.THROTTLED_QUERY_PARAM)&&!t?(this.response.writeHead(T.LAYER0_UNCACHED_PREFETCH_STATUS),this.response.end(),!1):!0}async setCreateResponseAction(t){if(this.runningImmediately)await t();else{if(this.createResponseAction!=null)throw new Error("You may only call one of the following once in your route handler: proxy, serveStatic, serviceWorker, redirect, send.");this.createResponseAction=t}}get runningImmediately(){return this.runImmediatelyDepthCounter>0}clearResponseAction(){return this.createResponseAction=void 0,this}};Ht.default=Va;function Ya(e){return typeof e=="string"&&(e={domainOrIp:e}),e}});var za=f(Ot=>{"use strict";var zp=Ot&&Ot.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ot,"__esModule",{value:!0});var Pt=require("os"),Qp=S(),Ka=zp(de());function Jp(e){if(Object.values(Qp.BACKENDS).includes(e)||Ka.default.get(`backends.${e}`,!1))return;let t=Object.keys(Ka.default.get("backends"));throw t&&t.length?new Error(`To fix this problem use one of the "backends" configured in layer0.config.js:${Pt.EOL}${Pt.EOL} - ${t.join(`${Pt.EOL} - `)}${Pt.EOL}${Pt.EOL}or add "${e}" to the "backends" property in layer0.config.js.`):new Error(`Add "${e}" to the "backends" property in layer0.config.js.`)}Ot.default=Jp});var pn=f(Ae=>{"use strict";var Xp=Ae&&Ae.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},Dt=Ae&&Ae.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ae,"__esModule",{value:!0});var qt=Xp(Li()),v=S(),Zp=Dt(or()),eg=Dt(Ni()),tg=Dt(Nr()),fn=Dt(Cr()),rg=Dt(za()),re=Ls(),sg=Je(),ng=60*60*24*365*10,Qa=class extends tg.default{constructor(t,r,s,i){super(t,r,s,i);this.stream=()=>{},this.setRequestHeader=(n,o)=>{re.validateSetRequestHeader(n),this.edgeConfig.transform.request.push({action:v.ACTIONS.setHeader,name:n,value:o})},this.updateRequestHeader=(n,o,a)=>{re.validateUpdateRequestHeader(n),this.edgeConfig.transform.request.push({action:v.ACTIONS.updateHeader,name:n,valueRegex:o.source,replaceValue:a})},this.removeRequestHeader=n=>{re.validateRemoveRequestHeader(n),this.edgeConfig.transform.request.push({action:v.ACTIONS.removeHeader,name:n})},this.setResponseHeader=(n,o)=>{re.validateSetResponseHeader(n),this.edgeConfig.transform.response.push({action:v.ACTIONS.setHeader,name:n,value:o})},this.updateResponseHeader=(n,o,a)=>{re.validateUpdateResponseHeader(n),this.edgeConfig.transform.response.push({action:v.ACTIONS.updateHeader,name:n,valueRegex:o.source,replaceValue:a})},this.removeResponseHeader=n=>{re.validateRemoveResponseHeader(n),this.edgeConfig.transform.response.push({action:v.ACTIONS.removeHeader,name:n})},this.setUpstreamResponseHeader=(n,o)=>{n.toLowerCase()!=v.HTTP_HEADERS.x0SurrogateKey&&re.validateSetResponseHeader(n),this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.setHeader,name:n,value:o})},this.updateUpstreamResponseHeader=(n,o,a)=>{re.validateUpdateResponseHeader(n),this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.updateHeader,name:n,valueRegex:o.source,replaceValue:a})},this.removeUpstreamResponseHeader=n=>{re.validateRemoveResponseHeader(n),this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.removeHeader,name:n})},this.addResponseCookie=(n,o)=>{this.edgeConfig.transform.response.push({action:v.ACTIONS.addCookie,name:n,value:o})},this.updateResponseCookie=(n,o,a)=>{this.edgeConfig.transform.response.push({action:v.ACTIONS.updateCookie,name:n,valueRegex:o.source,replaceValue:a})},this.removeResponseCookie=n=>{this.edgeConfig.transform.response.push({action:v.ACTIONS.removeCookie,name:n})},this.addUpstreamResponseCookie=(n,o)=>{this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.addCookie,name:n,value:o})},this.updateUpstreamResponseCookie=(n,o,a)=>{this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.updateCookie,name:n,valueRegex:o.source,replaceValue:a})},this.removeUpstreamResponseCookie=n=>{this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.removeCookie,name:n})},this.redirect=(n,o={})=>{let{to:a,statusCode:u,query:c}=this._readRedirectParams(n,o),l=!eg.default(c),h=qt.getBackReferences(fn.default.pathWithQueryString(a,c));if(this.shouldParseQueryString(h)||l){this.cache({edge:{maxAgeSeconds:ng}}),this.proxy(v.BACKENDS.js);return}if(this.setEdgeRoute({action:v.ACTIONS.syntheticRes,statusCode:u}),this.edgeConfig.transform.response.push({action:v.ACTIONS.setHeader,name:v.HTTP_HEADERS.location,value:"${url}"}),this.route.criteria.path){let p=fn.default.toEdgeRegexString(this.route.criteria.path+"{(\\?[^#]+)}?"),g=qt.getBackReferences(this.route.criteria.path),y=qt.default(this.route.criteria.path,a)+`\\${Object.keys(g).length+1}`;this.edgeConfig.transform.response.push({action:v.ACTIONS.updateHeader,name:v.HTTP_HEADERS.location,valueRegex:p,replaceValue:y})}else this.edgeConfig.transform.response.push({action:v.ACTIONS.updateHeader,name:v.HTTP_HEADERS.location,valueRegex:fn.default.toEdgeRegexString("([^?]*){(\\?[^#]+)}?"),replaceValue:`${a}\\2`})},this.serveStatic=(n,{permanent:o,exclude:a,onNotFound:u,loadingPage:c,expiresSeconds:l,statusCode:h,statusMessage:d}={})=>{n&&!n.startsWith("/")&&(n=`/${n}`);let p=[],g;c&&(p.push(c),g={valueRegex:this.route.toEdgeRegexString(),replaceValue:qt.default(this.route.criteria.path,c)}),n&&this.updatePath(n),typeof n=="string"&&p.push(n);let y=o===!0||Zp.default(o,"enabled")||!1;return this.setEdgeRoute({action:v.ACTIONS.proxy,backend:y?v.BACKENDS.permanentStatic:v.BACKENDS.static,fsPath:p,fsExclude:a,fallbackToCompute:u!=null,loadingPage:g,expiresSeconds:l,statusMessage:d,statusCode:h}),Promise.resolve()},this.proxy=(n,{path:o,transformResponse:a,transformRequest:u}={})=>(rg.default(n),a!=null||u!=null||typeof o=="function"?n=v.BACKENDS.js:typeof o=="string"&&this.updatePath(o),this.setEdgeRoute({action:v.ACTIONS.proxy,backend:n}),Promise.resolve()),this.updatePath=n=>{let o=qt.default(this.route.criteria.path,n);o[0]!=="/"&&(o=`/${o}`),this.edgeConfig.transform.request.push({action:v.ACTIONS.updatePath,valueRegex:this.route.toEdgeRegexString(),replaceValue:o})},this.cache=n=>{let{edge:o,browser:a,key:u}=n;if(o){let{maxAgeSeconds:c,staleWhileRevalidateSeconds:l,forcePrivateCaching:h}=o;this.edgeConfig.cache={maxAgeSeconds:c,staleWhileRevalidateSeconds:l,forcePrivateCaching:h}}else o===!1&&(this.edgeConfig.cache={disabled:!0});if(u&&(this.edgeConfig.cache||(this.edgeConfig.cache={}),this.edgeConfig.cache.customKey=u.toJSON()),a||a===!1){let{maxAgeSeconds:c,serviceWorkerSeconds:l}=a||{maxAgeSeconds:0};c===0?this.edgeConfig.transform.response.push({action:v.ACTIONS.setHeader,name:v.HTTP_HEADERS.cacheControl,value:"private, no-store, no-cache"}):c&&this.edgeConfig.transform.response.push({action:v.ACTIONS.setHeader,name:v.HTTP_HEADERS.cacheControl,value:`private, max-age=${c}`}),l&&this.edgeConfig.transform.response.push({action:v.ACTIONS.setHeader,name:v.HTTP_HEADERS.xSwCacheControl,value:`max-age=${l}`})}},this.send=(n,o=200,a)=>{typeof n=="function"?this.render():this.setEdgeRoute({action:v.ACTIONS.syntheticRes,statusCode:o,statusMessage:a,content:n})},this.compute=n=>{this.setEdgeRoute({action:v.ACTIONS.proxy,backend:v.BACKENDS.js})},this.render=()=>(this.setEdgeRoute({action:v.ACTIONS.proxy,backend:v.BACKENDS.js}),Promise.resolve()),this.edgeConfig={transform:{request:[],upstreamResponse:[],response:[]}}}shouldParseQueryString(t){let r=this.route.criteria.query;return r===void 0?!1:Object.keys(r).some(s=>{let i=r[s];return sg.isParamMatcher(i)&&!!t[s]})}setEdgeRoute(t){this.edgeConfig.route=t,this.edgeConfig.transform.upstreamResponse.push({action:v.ACTIONS.setHeader,name:v.HTTP_HEADERS.vary,value:v.HTTP_HEADERS.acceptEncoding})}};Ae.default=Qa});var _n=f(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});var Ja=class{constructor(){this.forcePrivateCaching=!1}};gn.default=Ja});var Za=f(Mt=>{"use strict";var ig=Mt&&Mt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Mt,"__esModule",{value:!0});var og=ig(pn()),Xa=class extends og.default{constructor(){super(...arguments);this.proxy=(t,r={})=>{throw new Error("Proxy cannot be used inside router.catch()")}}};Mt.default=Xa});var eu=f((wm,ag)=>{ag.exports={name:"@layer0/core",version:"3.17.3",main:"./index.js",license:"UNLICENSED",scripts:{docs:"typedoc",build:"rm -rf ./dist; mkdir ./dist; cp -r package.json README.md serverless.yml default-app ./dist; tsc; npm run bundle-handler;","bundle-handler":"esbuild src/lambda/handler.ts --bundle --minify --platform=node --target=node14.0 --outfile=dist/lambda/handler.js --log-level=error --sourcemap",watch:"npm-watch","ts:watch":"tsc --watch","push-build":"npm run build && cd dist && yalc push && cd ..",release:"cd ./dist; npm publish --access public","release:next":"npm run release -- --tag next",test:"jest --watchAll=false --runInBand --forceExit"},dependencies:{"@babel/parser":"^7.13.15","@babel/traverse":"^7.13.15","@types/lodash.clonedeep":"^4.5.6",ajv:"^6.12.6","babel-loader":"^8.2.2",chalk:"^2.4.2",chokidar:"^3.5.1","cls-hooked":"^4.2.2","content-type":"^1.0.4",cookie:"^0.4.1","cross-spawn":"^7.0.3","decode-uri-component":"^0.2.0",deepmerge:"^4.2.2",esbuild:"^0.11.15",express:"^4.17.1","fs-extra":"^8.1.0",globby:"^11.0.2","http-proxy":"^1.18.1","lodash.clonedeep":"^4.5.0","lru-cache":"^6.0.0","mime-types":"^2.1.29","node-fetch":"^2.6.1","path-to-regexp":"^6.2.0",pino:"^6.11.2",qs:"^6.10.1","resolve-package-path":"^2.0.0",shelljs:"^0.8.4",slash:"^3.0.0","tcp-port-used":"^1.0.2","ts-loader":"^8.2.0",unixify:"^1.0.0",uuid:"^8.3.2"},publishConfig:{directory:"dist"},watch:{"push-build":{patterns:["src","bin","serverless.yml","default-app","package.json"],extensions:["js","ts"],quiet:!1}},jest:{clearMocks:!0,collectCoverage:!0,transform:{"^.+\\.(js)?$":"babel-jest","^.+\\.ts$":"ts-jest"},moduleFileExtensions:["ts","js","json"],setupFilesAfterEnv:["<rootDir>/test/jest.js"],transformIgnorePatterns:["<rootDir>/node_modules/"],moduleNameMapper:{"../package.json":"<rootDir>/package.json","^@layer0/core(.*)$":"<rootDir>/src/$1"},collectCoverageFrom:["./src/**/*.{ts,js}","!**/mocks/**","!**/index.ts","!**/plugins/PluginBase.ts","!**/bin/**/*"]},devDependencies:{"@types/cls-hooked":"^4.3.1","@types/content-type":"^1.1.3","@types/cookie":"^0.3.3","@types/cross-spawn":"^6.0.2","@types/decode-uri-component":"^0.2.0","@types/express":"^4.17.7","@types/fs-extra":"^8.1.1","@types/http-proxy":"^1.17.4","@types/lodash":"^4.14.162","@types/lru-cache":"^5.1.0","@types/mime-types":"^2.1.0","@types/node":"^14.6.4","@types/route-parser":"^0.1.3","@types/shelljs":"^0.8.8","@types/tcp-port-used":"^1.0.0","@types/unixify":"^1.0.0","@types/uuid":"^8.0.1","@types/webpack-bundle-analyzer":"^3.9.0",lodash:"^4.17.21",webpack:"^5.27.0","webpack-bundle-analyzer":"^3.9.0","webpack-dev-middleware":"^4.1.0"}}});var iu=f(jt=>{"use strict";var Te=jt&&jt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(jt,"__esModule",{value:!0});var ug=Te(de()),tu=Te(cr()),cg=Te(Hi()),mn=Te(Oi()),lg=Te(pn()),hg=S(),ru=Te(_n()),dg=Je(),fg=Te(Za());function pg({edgeConfig:e},t){var r,s;return e.cache&&((r=e.cache)===null||r===void 0?void 0:r.maxAgeSeconds)&&((s=e.cache)===null||s===void 0?void 0:s.maxAgeSeconds)>0&&t?w(b({},e.cache),{matchExplicitMethod:t}):e.cache}function gg({edgeConfig:e}){return e.route}function _g({edgeConfig:e}){return e.transform}function mg(e){var t;let r=[],s=[],i,n;if(e.criteria.protocol){let o;if(typeof e.criteria.protocol=="string"?o=new RegExp(`^${e.criteria.protocol}$`,"i"):o=new RegExp(e.criteria.protocol),!o.test("http")&&!o.test("https"))throw new Error('Protocol matcher must match either "http" or "https"');i=o.source}if(e.criteria.path&&r.push({value:"${path}",matchRegex:e.toEdgeRegexString()}),e.criteria.method){let o;typeof e.criteria.method!="string"?o=e.criteria.method:(o=cg.default(e.criteria.method),Object.values(hg.HTTP_METHODS).includes(e.criteria.method)&&(n=e.criteria.method)),r.push({value:"${method}",matchRegex:tu.default(o)})}return e.criteria.headers&&Object.entries(e.criteria.headers).forEach(([o,a])=>{r.push({value:`\${req:${o}}`,matchRegex:mn.default(a)})}),((t=e.criteria.response)===null||t===void 0?void 0:t.statusCode)&&s.push({value:"${resp:status}",matchRegex:tu.default(e.criteria.response.statusCode)}),e.criteria.query&&Object.entries(e.criteria.query).forEach(([o,a])=>{dg.isParamMatcher(a)||r.push({value:`\${query:${o}}`,matchRegex:mn.default(a)})}),e.criteria.cookies&&Object.entries(e.criteria.cookies).forEach(([o,a])=>{r.push({value:`\${req:cookie:${o}}`,matchRegex:mn.default(a)})}),{match:r,matchResp:s,matchExplicitMethod:n,matchProtocolJavaScriptRegExpSource:i}}async function vg(e){let t={};if(!Object.keys(e.getDestinations()).length)t={default:await nu(e)};else for(let r in e.getDestinations())t[r]=await nu(e.getDestinations()[r]);return{version:yg(),backends:b({},ug.default.get("backends")),destinations:t}}jt.default=vg;function yg(){return eu().version}async function su(e,t,r){try{await e.handler(t)}catch(a){Error.captureStackTrace(a),r.push({route:e.toString(),stackTrace:a.stack})}let{match:s,matchResp:i,matchExplicitMethod:n,matchProtocolJavaScriptRegExpSource:o}=mg(e);return{path:e.criteria.path,routeJson:e.toJson(),match:s,matchResp:i,matchProtocolJavaScriptRegExpSource:o,cache:pg(t,n),route:gg(t),transform:_g(t)}}async function nu(e){let t=[],r={index:e.index,errorRoutes:await Promise.all(e.getRouteGroups().getRoutes().filter(s=>s.isRespRoute()).map(s=>su(s,new fg.default({url:"",headers:{}},{},s,new ru.default),t))),routes:await Promise.all(e.getRouteGroups().getRoutes().filter(s=>!s.isRespRoute()).map(s=>su(s,new lg.default({url:"",headers:{}},{},s,new ru.default),t)))};if(t.length){let s=`
Errors occurred while attempting to deploy your application to Layer0 edge.
The following ${t.length>1?"routes":"route"} could not be processed:`;throw t.forEach(({route:i,stackTrace:n})=>{s=s.concat(`
* ${i}: ${n}`)}),new Error(s)}return r}});var ou=f(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});function Rg(e,t){if(!e||!e.length)return;let r,s,i=!1;for(let n of e){if(!i){r=n,t&&(s=t(n)),i=!0;continue}if(t){let o=t(n);o<s&&(r=n,s=o)}else n<r&&(r=n)}return r}vn.default=Rg});var uu=f(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});var au=class{constructor(){this._tasks=[],this._resolveHandler=Function.prototype,this._errorHandler=t=>{throw t}}add(...t){return this._tasks.push(...t),this}onTaskDone(t){return this._resolveHandler=t,this}onTaskError(t){return this._errorHandler=t,this}resolve(){let t=this._convertTasksToPromises().map((r,s)=>r.then(i=>(this._resolveHandler(i),i)).catch(i=>this._errorHandler(i)));return Promise.all(t)}_convertTasksToPromises(){return this._tasks.map(t=>{if(typeof t!="function")return Promise.resolve(t);try{let r=t();return r instanceof Promise?r:Promise.resolve(r)}catch(r){return Promise.reject(r)}})}};yn.default=au});var hu=f(Nt=>{"use strict";var cu=Nt&&Nt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Nt,"__esModule",{value:!0});var Eg=cu(de()),lu=cu(uu()),Lt=class{constructor(){this.options=[]}push(...t){this.options.push(...t)}static async resolveDestinationPreloadConfig(t,r){let s=[];return await new lu.default().add(...t.preloadRequests.options).onTaskDone(i=>{s.push(...i.map(n=>w(b({},n),{destination:r})))}).resolve(),{requests:s}}static async resolvePreloadConfig(t){let r=[],s=new lu.default,i=t.getDestinations();if(!Object.keys(i).length)s.add(Lt.resolveDestinationPreloadConfig(t,"default"));else for(let n in i)s.add(Lt.resolveDestinationPreloadConfig(i[n],n));return await s.onTaskDone(({requests:n})=>{r.push(...n)}).resolve(),{requests:r,concurrency:Eg.default.get("prerenderConcurrency",null)}}};Nt.default=Lt});var du=f(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});function bg(e){return new Promise(t=>{e.body="",e.on("data",r=>e.body+=r.toString()),e.on("end",t)})}Rn.default=bg});var fu=f(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});function Cg(){return process.env.LAYER0_ROOT_SOURCE_DIR||process.cwd()}Ir.getSourceDir=Cg;function Ag(e){process.env.LAYER0_ROOT_SOURCE_DIR=e}Ir.setSourceDir=Ag});var bn=f(se=>{"use strict";var $r=se&&se.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(se,"__esModule",{value:!0});var Tg=$r(Cr()),wg=un(),En=Ye(),pu=require("path"),gu=$r(ue()),Sg=$r(Is()),It=S(),xg=fu(),_u=$r(Fr());se.staticAssetManifest={};se.STATIC_ASSET_MANIFEST_FILE="static-asset-manifest.json";var mu=class{constructor(t){if(this._routes=[],!t)throw new Error("Route group name is required!");this.name=t}match(t,r,{index:s,label:i}={}){let n=new Tg.default(t,r,{label:i});return s!=null?this._routes.splice(s,0,n):this._routes.push(n),this}dir(t,r){let s=pu.join(xg.getSourceDir(),t),i=se.staticAssetManifest[_u.default(t)]=[],{ignore:n,label:o}=r;typeof n=="string"&&(n=[n]);let a=En.isCloud()?this.staticAssetsForPath(t):gu.default("globby").sync(r.glob||"**/*",{cwd:s,onlyFiles:!0,ignore:n||[]});r.sort&&(a=r.sort(a));for(let u of a){let c=r.paths&&r.paths(u)||[`/${u}`];En.isCloud()||i.push(_u.default(u));for(let l of c){let h=l.replace(/\/index.html$/,"");h.length===0&&(h="/"),this.match(h,async d=>{r.handler&&r.handler(u)(d)},{label:o})}}return this}static(t,r){let s=i=>n=>{r.handler&&r.handler(i)(n),n.serveStatic(`${t}/${i}`)};return this.dir(t,w(b({},r),{handler:s,label:`static('${t}')`}))}requireBasicAuth(t){let{route:r,username:s,password:i,realm:n="Access to the site"}=t;if(s&&i){let o=Buffer.from(`${s}:${i}`).toString("base64");r=Sg.default(r),this.match(w(b({},r),{headers:w(b({},r.headers),{[It.HTTP_HEADERS.authorization]:null,[It.HTTP_HEADERS.x0MatchedRoutes]:null})}),({send:a,setResponseHeader:u})=>{u("WWW-Authenticate",`Basic realm="${n}"`),a("",401,"Unauthorized")}).match(w(b({},r),{headers:w(b({},r.headers),{[It.HTTP_HEADERS.authorization]:new RegExp(`^((?!Basic ${o}).)*$`),[It.HTTP_HEADERS.x0MatchedRoutes]:null})}),({send:a})=>{a("",403,"Forbidden")}).match(w(b({},r),{headers:w(b({},r.headers),{[It.HTTP_HEADERS.x0MatchedRoutes]:null})}),({removeRequestHeader:a})=>{a("authorization")})}return this}staticAssetsForPath(t){return gu.default(pu.join(process.cwd(),se.STATIC_ASSET_MANIFEST_FILE))[t]}clear(){return this._routes=[],En.isCloud()||wg.clearCache(),this}get routes(){return this._routes}get length(){return this._routes.length}};se.default=mu});var yu=f($t=>{"use strict";var Hg=$t&&$t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($t,"__esModule",{value:!0});var Pg=Hg(bn()),Og=S(),vu=class{constructor(){this.routeGroups=[]}add(t){return this.routeGroups.push(t),this}getGroups(){return this.routeGroups}findByName(t){return this.routeGroups.find(r=>r.name===t)}getRoutes(){let t=[];return this.getGroups().forEach(r=>{t=t.concat(r.routes)}),this.fallback&&(t=t.concat(this.fallback.routes)),t}setFallback(t){let r=new Pg.default(Og.ROUTES_FALLBACK);r.match(null,t),this.fallback=r}get length(){return this.routeGroups.length}};$t.default=vu});var Cu=f(we=>{"use strict";var V=we&&we.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Dg=we&&we.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(we,"__esModule",{value:!0});var _=S(),Ru=zr(),qg=ni(),Mg=V(pi()),jg=V(gi()),Lg=V(de()),Ng=V(iu()),Ig=V(Cs()),$g=V(ou()),Eu=V(hu()),kg=V(du()),Ug=V(_n()),Bg=V(Nr()),bu=Dg(bn()),Fg=V(yu()),Fe=class{constructor(t={excludeBuiltInRoutes:!1}){this.routeGroups=new Fg.default,this.preloadRequests=new Eu.default,this.plugins=[],this.destinations={},this.nextRouterIndex=0,this._index=0,this.processRequestHeaders=r=>{r.headers[_.HTTP_HEADERS.xRequestId]||(this.newRequestId=qg.v4(),r.headers[_.HTTP_HEADERS.xRequestId]=this.newRequestId);let s=r.headers[_.HTTP_HEADERS.acceptEncoding];typeof s=="string"&&/gzip/.test(s)?r.headers[_.HTTP_HEADERS.acceptEncoding]="gzip":delete r.headers[_.HTTP_HEADERS.acceptEncoding];let i=r.connection,n="127.0.0.1";if(i&&i.remoteAddress){if(n=i.remoteAddress,r.headers[_.HTTP_HEADERS.x0Protocol]!=="http"){let o=r.headers[_.HTTP_HEADERS.cookie];typeof o=="string"&&/\blocal_layer0_emulate_http_protocol=true\b/.test(o)?r.headers[_.HTTP_HEADERS.x0Protocol]="http":r.headers[_.HTTP_HEADERS.x0Protocol]="https"}}else r.headers[_.HTTP_HEADERS.x0Protocol]||(r.headers[_.HTTP_HEADERS.x0Protocol]="https");r.headers[_.HTTP_HEADERS.xForwardedFor]?r.headers[_.HTTP_HEADERS.xForwardedFor]=`${r.headers[_.HTTP_HEADERS.xForwardedFor]}, ${n}`:r.headers[_.HTTP_HEADERS.xForwardedFor]=`${n}`,r.headers[_.HTTP_HEADERS.x0ClientIp]||(r.headers[_.HTTP_HEADERS.x0ClientIp]=r.headers[_.HTTP_HEADERS.xForwardedFor].split(",")[0]),Fe.isRequestFromEdge(r)||(this.processRequestDeviceHeaders(r),this.processRequestGeoHeaders(r))},this.processRequestDeviceHeaders=r=>{let s="desktop",i="generic",n=!1,o="generic",a=(r.headers[_.HTTP_HEADERS.userAgent]||"").toLowerCase();/ipad/.test(a)?(s="tablet",i="apple"):/ip(hone|od)/.test(a)?(s="smartphone",i="apple"):/android.*(mobile|mini)/.test(a)?(s="smartphone",i="android"):/android/.test(a)?(s="tablet",i="android"):/opera mobi/.test(a)?(s="smartphone",i="android"):/playbook u rim tablet/.test(a)?(s="tablet",i="blackberry"):/hp-tablet.*touchpad/.test(a)?(s="tablet",i="hp"):/kindle\/3/.test(a)?(s="tablet",i="kindle"):/mobile.+firefox/.test(a)?(s="mobile",i="firefoxos"):/^htc/.test(a)?(s="smartphone",i="htc"):/fennec/.test(a)?(s="smartphone",i="fennec"):/iemobile/.test(a)?(s="smartphone",i="microsoft"):/blackberry/.test(a)||/bb10.*mobile/.test(a)?(s="smartphone",i="blackberry"):/gt-.*build\/gingerbread/.test(a)?(s="smartphone",i="android"):/symbianos.*applewebkit/.test(a)?(s="smartphone",i="symbian"):(/symbian/.test(a)||/^sonyericsson/.test(a)||/^nokia/.test(a)||/^samsung/.test(a)||/^lg/.test(a)||/bada/.test(a)||/blazer/.test(a)||/cellphone/.test(a)||/midp-2.0/.test(a)||/u990/.test(a)||/netfront/.test(a)||/opera mini/.test(a)||/palm/.test(a)||/nintendo wii/.test(a)||/playstation portable/.test(a)||/portalmmm/.test(a)||/proxinet/.test(a)||/sonyericsson/.test(a)||/windows ?ce/.test(a)||/winwap/.test(a)||/eudoraweb/.test(a)||/240x320/.test(a)||/avantgo/.test(a))&&(s="mobile"),/bot/.test(a)||/crawler/.test(a)||/headless/.test(a)||/prerender/.test(a)||/preview/.test(a)||/scanner/.test(a)||/slurp/.test(a)||/spider/.test(a)||/(developers.google.com\/+\/web\/snippet|embedly|facebookexternalhit|flipboard|googlepagespeed|google page speed)/.test(a)||/(ia_archiver|moov-prerender-cache-exerciser|nuzzel|outbrain|pinterest|qwantify|tumblr|vkshare)/.test(a)||/(w3c_validator|whatsapp|xing-contenttabreceiver|yahoo)/.test(a)?n=!0:n=!1,/edge/.test(a)?o="edge":/chrome|chromium|crios/.test(a)?o="chrome":/firefox/.test(a)?o="firefox":/opera|opr/.test(a)?o="opera":/msie/.test(a)||/trident/.test(a)?o="msie":/safari/.test(a)&&(o="safari"),r.headers[_.HTTP_HEADERS.x0Device]=s,r.headers[_.HTTP_HEADERS.x0DeviceIsBot]=n?"1":"0",r.headers[_.HTTP_HEADERS.x0Vendor]=i,r.headers[_.HTTP_HEADERS.x0Browser]=o},this.processRequestGeoHeaders=r=>{r.headers[_.HTTP_HEADERS.x0GeoCity]="San Francisco",r.headers[_.HTTP_HEADERS.x0GeoCountryCode]="US",r.headers[_.HTTP_HEADERS.x0GeoLatitude]="37.792094",r.headers[_.HTTP_HEADERS.x0GeoLongitude]="-122.401622",r.headers[_.HTTP_HEADERS.x0GeoPostalCode]="94104"},this.isUserHeaderCountWithinLimits=r=>Object.keys(r).filter(i=>i.toLowerCase().indexOf(_.LAYER0_HEADERS_PREFIX)!==0).length<=_.LAYER0_MAX_USER_HEADERS_ALLOWED,this.patchResWriteHead=(r,s)=>{let i=s.writeHead;s.writeHead=(...n)=>{s.writeHead=i,this.newRequestId&&s.setHeader(_.HTTP_HEADERS.xRequestId,this.newRequestId);let a=n[2];if(a)for(let u of Object.keys(a))s.setHeader(u,Ig.default(r,s,a[u]));if(this.isUserHeaderCountWithinLimits(s.getHeaders())){s.writeHead(...n);return}s.writeHead(_.LAYER0_TOO_MANY_HEADERS_STATUS_CODE,"Too many response headers")}},this.run=async(r,s)=>{let i=new Ru.InternalTiming(Ru.InternalNames.routeMatching).start(),n=this,o=new Ug.default;if(this.processRequestHeaders(r),!this.isUserHeaderCountWithinLimits(r.headers)){s.writeHead(_.LAYER0_TOO_MANY_HEADERS_STATUS_CODE,"Too many request headers"),s.end();return}if(await kg.default(r),this.patchResWriteHead(r,s),Object.keys(this.destinations).length>1){let{LAYER0_ROUTER_DESTINATION:l}=process.env,h=r.headers[_.HTTP_HEADERS.x0Destination]||l;if(h||(h=$g.default(Object.keys(this.destinations),d=>this.destinations[d]._index)),n=this.destinations[h],!n)throw new Error(`Routing destination "${h}" not found.`)}n.plugins.forEach(l=>l.onRequest(r));let a=l=>{let h=new Bg.default(r,s,l,o);return Fe.isRequestFromEdge(r)?jg.default.create(h):h},u=n.routeGroups.getRoutes().filter(l=>!l.isRespRoute()),c=n.routeGroups.getRoutes().filter(l=>l.isRespRoute());for(let l of u){let h;try{if(!l.match(r))continue;h=a(l),i.pause(),await l.handler(h);let d=await h.sendResponse({beforeResponse:async p=>{if(!Fe.isRequestFromEdge(r)){i.ended&&i.resume();for(let g of c)if(!!g.matchResponse(p))return h=a(g),i.pause(),await g.handler(h),h.sendResponse(),!1}return!0}});if(i.resume(),d)return}catch(d){h=h||a(r,s,l,o),h.onRouteError(d);return}}i.end(),this.builtInFallback(r,s)},t.excludeBuiltInRoutes||Mg.default(this)}getStaticAssetManifest(){return bu.staticAssetManifest}setBackend(t,r){return Lg.default.get("backends")[t]=r,this}use(t){return t.onRegister(this),this.plugins.push(t),this}destination(t,r){return r.setIndex(this.nextRouterIndex++),this.destinations[t]=r,this}getPlugins(){let t=this.plugins;for(let r of Object.values(this.destinations))t=t.concat(r.getPlugins());return t}setIndex(t){this._index=t}get index(){return this._index}group(t,r){let s=new bu.default(t);return r(s),this.routeGroups.add(s),this}match(t,r){return this.group("root",s=>s.match(t,r))}prerender(...t){return this.preloadRequests.push(...t),this}matchMethod(t,r,s){if(typeof r=="string")return this.match({method:t,path:r},s);if(r.method)throw new Error(`Invalid criteria property method passed to call to Router#${t}. Specifying a method in the criteria is redundant.`);return this.match(w(b({},r),{method:t}),s)}head(t,r){return this.matchMethod(_.HTTP_METHODS.head,t,r)}get(t,r){return this.matchMethod(_.HTTP_METHODS.get,t,r)}post(t,r){return this.matchMethod(_.HTTP_METHODS.post,t,r)}delete(t,r){return this.matchMethod(_.HTTP_METHODS.delete,t,r)}put(t,r){return this.matchMethod(_.HTTP_METHODS.put,t,r)}patch(t,r){return this.matchMethod(_.HTTP_METHODS.patch,t,r)}options(t,r){return this.matchMethod(_.HTTP_METHODS.options,t,r)}fallback(t){return this.routeGroups.setFallback(t),this}catch(t,r){let s;return t instanceof RegExp?s=t:s=new RegExp(`^${t.toString()}$`),this.group(_.ROUTES_CATCH_GROUP,i=>i.match({headers:{"x-0-error-status-code":s},response:{statusCode:s}},async n=>{await r(n),n.cache({edge:!1,browser:{maxAgeSeconds:0}})})),this}builtInFallback(t,r){let s=t.connection;s&&s.remoteAddress?r.writeHead(404):t.headers[_.HTTP_HEADERS.x0Protocol]==="http"?(r.setHeader(_.HTTP_HEADERS.location,`https://${t.headers[_.HTTP_HEADERS.host]}${t.url}`),r.writeHead(301)):r.writeHead(404),r.end()}static(t,r={}){return this.group("root",s=>s.static(t,r))}requireBasicAuth(t){return this.group("root",r=>r.requireBasicAuth(t))}createEdgeConfig(){return Ng.default(this)}createPreloadConfig(){return Eu.default.resolvePreloadConfig(this)}getDestinations(){return this.destinations}getRouteGroups(){return this.routeGroups}toString(){return`Routes
======
`+this.routeGroups.getRoutes().map((t,r)=>`${r}:	${t.toString()}`).join(`
`)}static isRequestFromEdge(t){return typeof t.headers[_.HTTP_HEADERS.x0Version]=="string"}};we.default=Fe});var Tu=f(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});var Au=class{constructor(t){this.name=t}byPattern(t){this.pattern=t}toJSON(){if(!this.pattern)throw new Error("byPattern is required for group "+this.name);return{groupedValue:this.name,matchRegex:this.pattern.source}}};Cn.default=Au});var Su=f(kt=>{"use strict";var Wg=kt&&kt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(kt,"__esModule",{value:!0});var Gg=Wg(Tu()),wu=class{constructor(){this.groups=[],this.name=null}group(t){let r=new Gg.default(t);return this.groups.push(r),r}toJSON(){return this.groups.map(t=>t.toJSON())}};kt.default=wu});var An=f(B=>{"use strict";var Vg=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(B,"__esModule",{value:!0});var xu=Vg(Su()),Yg=fr();B.CUSTOM_CACHE_KEY_ACTIONS={blacklistAll:"blacklist-all-query-parameters",blacklistSome:"blacklist-some-query-parameters",whitelistSome:"whitelist-some-query-parameters",addValue:"add-value",removeMethod:"remove-method",removeBody:"remove-body"};var kr=class{constructor(){this.config=[],this.actions=[]}clone(){let t=new kr;return t.actions=this.actions,t.config=this.config,t}excludeAllQueryParameters(){return this.config.push({action:B.CUSTOM_CACHE_KEY_ACTIONS.blacklistAll}),this.actions.push((t,r)=>{t.query={}}),this}excludeQueryParameters(...t){return this.config.push({action:B.CUSTOM_CACHE_KEY_ACTIONS.blacklistSome,names:t}),this.actions.push((r,s)=>{for(let i of t)delete r.query[i]}),this}excludeAllQueryParametersExcept(...t){return this.config.push({action:B.CUSTOM_CACHE_KEY_ACTIONS.whitelistSome,names:t}),this.actions.push((r,s)=>{let i=new Set(t);for(let n in r.query)i.has(n)||delete r.query[n]}),this}addHeader(t,r){return this.actions.push((s,i)=>{let n=i.headers[t];Array.isArray(n)||(n=[n]),r?s.headers[t]=this.createGroupedValue(r,n):s.headers[t]=n}),this.addValue(`\${req:${t}}`,r)}removeMethod(){return this.actions.push((t,r)=>{t.method=void 0}),this.config.push({action:B.CUSTOM_CACHE_KEY_ACTIONS.removeMethod}),this}removeBody(){return this.actions.push((t,r)=>{t.body=void 0}),this.config.push({action:B.CUSTOM_CACHE_KEY_ACTIONS.removeBody}),this}createGroupedValue(t,r){let s=new xu.default,i=[];t(s);let n=this.findMatchingGroup(s,r);return n?i.push(n):i.push(...r),i}findMatchingGroup(t,r){var s;for(let i of t.groups)for(let n of r)if((s=i.pattern)===null||s===void 0?void 0:s.test(n))return i.name}addDevice(){return this.addHeader("x-0-device")}addVendor(){return this.addHeader("x-0-vendor")}addIsBot(){return this.addHeader("x-0-device-is-bot")}addBrowser(){return this.addHeader("x-0-browser")}addCookie(t,r){return this.actions.push((s,i)=>{let n=i.headers.cookie||"";Array.isArray(n)&&(n=n.join(";"));let a=Yg.parse(n)[t];r?s.cookies[t]=this.createGroupedValue(r,[a]):s.cookies[t]=a}),this.addValue(`\${req:cookie:${t}}`,r)}addValue(t,r){let s={action:B.CUSTOM_CACHE_KEY_ACTIONS.addValue,value:t};if(r!=null){let i=new xu.default;r(i),s.groups=i.toJSON()}return this.config.push(s),this}getActions(){return this.actions}toJSON(){return this.config}};B.default=kr});var Hu=f(Ut=>{"use strict";var Kg=Ut&&Ut.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ut,"__esModule",{value:!0});var zg=Kg(An());function Qg(){return new zg.default}Ut.default=Qg});var Pu=f(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});var Jg=Cu();We.Router=Jg.default;var Xg=An();We.CustomCacheKey=Xg.default;var Zg=Nr();We.ResponseWriter=Zg.default;var e_=Hu();We.createCustomCacheKey=e_.default});var Du=f(Bt=>{"use strict";function Ou(e){for(var t in e)Bt.hasOwnProperty(t)||(Bt[t]=e[t])}Object.defineProperty(Bt,"__esModule",{value:!0});Ou(Pu());Ou(S());var t_=de();Bt.config=t_.default});xn(exports);Bu(exports,{default:()=>r_});var qu=Wu(Du()),r_=new qu.Router().get("/_nuxt/:path*",({cache:e,serveStatic:t})=>{e({browser:{maxAgeSeconds:60*60*24*365*10},edge:{maxAgeSeconds:60*60*24*365*10}}),t(".output/public/_nuxt/:path*")}).fallback(({renderWithApp:e})=>{e()});0&&(module.exports={});
/*!
 * Array of passes.
 *
 * A `pass` is just a function that is executed on `req, res, options`
 * so that you can easily add new checks while still keeping the base
 * flexible.
 */
/*!
 * Array of passes.
 *
 * A `pass` is just a function that is executed on `req, socket, options`
 * so that you can easily add new checks while still keeping the base
 * flexible.
 */
/*!
 * Caron dimonio, con occhi di bragia
 * loro accennando, tutte le raccoglie;
 * batte col remo qualunque s’adagia 
 *
 * Charon the demon, with the eyes of glede,
 * Beckoning to them, collects them all together,
 * Beats with his oar whoever lags behind
 *          
 *          Dante - The Divine Comedy (Canto III)
 */
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
//# sourceMappingURL=routes.js.map
